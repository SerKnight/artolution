window.CodeMirror=function(){function t(r,n){var i,l,a;if(!(this instanceof t))return new t(r,n);this.options=n=n||{};for(i in Yr)!n.hasOwnProperty(i)&&Yr.hasOwnProperty(i)&&(n[i]=Yr[i]);u(n),i=this.display=e(r,"string"==typeof n.value?0:n.value.first),i.wrapper.CodeMirror=this,s(this),n.autofocus&&!zn&&q(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new ur},o(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),l=n.value,"string"==typeof l&&(l=new on(n.value,n.mode)),G(this,Ee)(this,l),wn&&setTimeout(yr(Z,this,!0),20),Q(this);try{a=document.activeElement==i.input}catch(t){}a||n.autofocus&&!zn?setTimeout(yr(pt,this),20):mt(this),G(this,function(){for(var t in Ur)Ur.propertyIsEnumerable(t)&&Ur[t](this,n[t],_r);for(t=0;t<qr.length;++t)qr[t](this)})()}function e(t,e){var r,n={},i=n.input=Cr("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none;");return Sn?i.style.width="1000px":i.setAttribute("wrap","off"),i.setAttribute("autocorrect","off"),i.setAttribute("autocapitalize","off"),n.inputDiv=Cr("div",[i],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),n.scrollbarH=Cr("div",[Cr("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),n.scrollbarV=Cr("div",[Cr("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),n.scrollbarFiller=Cr("div",null,"CodeMirror-scrollbar-filler"),n.lineDiv=Cr("div"),n.selectionDiv=Cr("div",null,null,"position: relative; z-index: 1"),n.cursor=Cr("div","\xa0","CodeMirror-cursor"),n.otherCursor=Cr("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"),n.measure=Cr("div",null,"CodeMirror-measure"),n.lineSpace=Cr("div",[n.measure,n.selectionDiv,n.lineDiv,n.cursor,n.otherCursor],null,"position: relative; outline: none"),n.mover=Cr("div",[Cr("div",[n.lineSpace],"CodeMirror-lines")],null,"position: relative"),n.sizer=Cr("div",[n.mover],"CodeMirror-sizer"),n.heightForcer=Cr("div","\xa0",null,"position: absolute; height: "+un+"px"),n.gutters=Cr("div",null,"CodeMirror-gutters"),n.lineGutter=null,r=Cr("div",[n.sizer,n.heightForcer,n.gutters],null,"position: relative; min-height: 100%"),n.scroller=Cr("div",[r],"CodeMirror-scroll"),n.scroller.setAttribute("tabIndex","-1"),n.wrapper=Cr("div",[n.inputDiv,n.scrollbarH,n.scrollbarV,n.scrollbarFiller,n.scroller],"CodeMirror"),Ln&&(n.gutters.style.zIndex=-1,n.scroller.style.paddingRight=0),t.appendChild?t.appendChild(n.wrapper):t(n.wrapper),En&&(i.style.width="0px"),Sn||(n.scroller.draggable=!0),Wn?(n.inputDiv.style.height="1px",n.inputDiv.style.position="absolute"):Ln&&(n.scrollbarH.style.minWidth=n.scrollbarV.style.minWidth="18px"),n.viewOffset=n.lastSizeC=0,n.showingFrom=n.showingTo=e,n.lineNumWidth=n.lineNumInnerWidth=n.lineNumChars=null,n.prevInput="",n.alignWidgets=!1,n.pollingFast=!1,n.poll=new ur,n.draggingText=!1,n.cachedCharWidth=n.cachedTextHeight=null,n.measureLineCache=[],n.measureLineCachePos=0,n.inaccurateSelection=!1,n.maxLine=null,n.maxLineLength=0,n.maxLineChanged=!1,n.wheelDX=n.wheelDY=n.wheelStartX=n.wheelStartY=null,n}function r(e){e.doc.mode=t.getMode(e.options,e.doc.modeOption),e.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),e.doc.frontier=e.doc.first,M(e,100),e.state.modeGen++,e.curOp&&Y(e)}function n(t){var e=B(t.display),r=t.options.lineWrapping,n=r&&Math.max(5,t.display.scroller.clientWidth/R(t.display)-3);return function(i){return de(t.doc,i)?0:r?(Math.ceil(i.text.length/n)||1)*e:e}}function i(t){var e=t.doc,r=n(t);e.iter(function(t){var e=r(t);e!=t.height&&Pe(t,e)})}function o(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),D(t)}function l(t){s(t),Y(t)}function s(t){var e,r,n,i=t.display.gutters,o=t.options.gutters;for(wr(i),e=0;e<o.length;++e)r=o[e],n=i.appendChild(Cr("div",null,"CodeMirror-gutter "+r)),"CodeMirror-linenumbers"==r&&(t.display.lineGutter=n,n.style.width=(t.display.lineNumWidth||1)+"px");i.style.display=e?"":"none"}function a(t,e){var r,n,i;if(0==e.height)return 0;for(r=e.text.length,i=e;n=ue(i,-1);)n=n.find(),i=ze(t,n.from.line),r+=n.from.ch-n.to.ch;for(i=e;n=he(i);)n=n.find(),r-=i.text.length-n.from.ch,i=ze(t,n.to.line),r+=i.text.length-n.to.ch;return r}function c(t){var e=t.display,r=t.doc;e.maxLine=ze(r,r.first),e.maxLineLength=a(r,e.maxLine),e.maxLineChanged=!0,r.iter(function(t){var n=a(r,t);n>e.maxLineLength&&(e.maxLineLength=n,e.maxLine=t)})}function u(t){for(var e=!1,r=0;r<t.gutters.length;++r)"CodeMirror-linenumbers"==t.gutters[r]&&(t.lineNumbers?e=!0:t.gutters.splice(r--,1));!e&&t.lineNumbers&&t.gutters.push("CodeMirror-linenumbers")}function h(t,e){var r=e+2*t.lineSpace.offsetTop;t.sizer.style.minHeight=t.heightForcer.style.top=r+"px";var r=Math.max(r,t.scroller.scrollHeight),n=t.scroller.scrollWidth>t.scroller.clientWidth,i=r>t.scroller.clientHeight;i?(t.scrollbarV.style.display="block",t.scrollbarV.style.bottom=n?Mr(t.measure)+"px":"0",t.scrollbarV.firstChild.style.height=r-t.scroller.clientHeight+t.scrollbarV.clientHeight+"px"):t.scrollbarV.style.display="",n?(t.scrollbarH.style.display="block",t.scrollbarH.style.right=i?Mr(t.measure)+"px":"0",t.scrollbarH.firstChild.style.width=t.scroller.scrollWidth-t.scroller.clientWidth+t.scrollbarH.clientWidth+"px"):t.scrollbarH.style.display="",n&&i?(t.scrollbarFiller.style.display="block",t.scrollbarFiller.style.height=t.scrollbarFiller.style.width=Mr(t.measure)+"px"):t.scrollbarFiller.style.display="",On&&0===Mr(t.measure)&&(t.scrollbarV.style.minWidth=t.scrollbarH.style.minHeight=Dn?"18px":"12px")}function f(t,e,r){var n,i=t.scroller.scrollTop,o=t.wrapper.clientHeight;return"number"==typeof r?i=r:r&&(i=r.top,o=r.bottom-r.top),i=Math.floor(i-t.lineSpace.offsetTop),n=Math.ceil(i+o),{from:Re(e,i),to:Re(e,n)}}function d(t){var e,r,n,i=t.display;if(i.alignWidgets||i.gutters.firstChild&&t.options.fixedGutter){var o=m(i)-i.scroller.scrollLeft+t.doc.scrollLeft,l=i.gutters.offsetWidth,s=o+"px";for(e=i.lineDiv.firstChild;e;e=e.nextSibling)if(e.alignable)for(r=0,n=e.alignable;r<n.length;++r)n[r].style.left=s;t.options.fixedGutter&&(i.gutters.style.left=o+l+"px")}}function p(t){if(!t.options.lineNumbers)return!1;var e=t.doc,e=""+t.options.lineNumberFormatter(e.first+e.size-1+t.options.firstLineNumber),t=t.display;if(e.length!=t.lineNumChars){var r=t.measure.appendChild(Cr("div",[Cr("div",e)],"CodeMirror-linenumber CodeMirror-gutter-elt")),n=r.firstChild.offsetWidth,r=r.offsetWidth-n;return t.lineGutter.style.width="",t.lineNumInnerWidth=Math.max(n,t.lineGutter.offsetWidth-r),t.lineNumWidth=t.lineNumInnerWidth+r,t.lineNumChars=t.lineNumInnerWidth?e.length:-1,t.lineGutter.style.width=t.lineNumWidth+"px",!0}return!1}function m(t){return Sr(t.scroller).left-Sr(t.sizer).left}function g(t,e,r){var n=t.display.showingFrom,i=t.display.showingTo,e=v(t,e,r);return e&&(sr(t,"update",t),(t.display.showingFrom!=n||t.display.showingTo!=i)&&sr(t,"viewportChange",t,t.display.showingFrom,t.display.showingTo)),L(t),h(t.display,t.doc.height),e}function v(t,e,r){var n,i,o,l,s,a,c,u,h,d,m,g,x=t.display,w=t.doc;if(x.wrapper.clientWidth){if(n=f(x,w,r),!(0==e.length&&n.from>x.showingFrom&&n.to<x.showingTo)){if(p(t)&&(e=[{from:w.first,to:w.first+w.size}]),i=x.sizer.style.marginLeft=x.gutters.offsetWidth+"px",x.scrollbarH.style.left=t.options.fixedGutter?i:"0",o=1/0,t.options.lineNumbers)for(c=0;c<e.length;++c)if(e[c].diff){o=e[c].from;break}if(c=w.first+w.size,i=Math.max(n.from-t.options.viewportMargin,w.first),n=Math.min(c,n.to+t.options.viewportMargin),x.showingFrom<i&&20>i-x.showingFrom&&(i=Math.max(w.first,x.showingFrom)),x.showingTo>n&&20>x.showingTo-n&&(n=Math.min(c,x.showingTo)),Kn)for(i=Be(fe(w,ze(w,i)));n<c&&de(w,ze(w,n));)++n;if(l=[{from:Math.max(x.showingFrom,w.first),to:Math.min(x.showingTo,c)}],l=l[0].from>=l[0].to?[]:b(l,e),Kn)for(c=0;c<l.length;++c)for(e=l[c];s=he(ze(w,e.to-1));){if(a=s.find().from.line,!(a>e.from)){l.splice(c--,1);break}e.to=a}for(c=a=0;c<l.length;++c)e=l[c],e.from<i&&(e.from=i),e.to>n&&(e.to=n),e.from>=e.to?l.splice(c--,1):a+=e.to-e.from;if(a!=n-i||i!=x.showingFrom||n!=x.showingTo){for(l.sort(function(t,e){return t.from-e.from}),c=document.activeElement,a<.7*(n-i)&&(x.lineDiv.style.display="none"),C(t,i,n,l,o),x.lineDiv.style.display="",document.activeElement!=c&&c.offsetHeight&&c.focus(),(o=i!=x.showingFrom||n!=x.showingTo||x.lastSizeC!=x.wrapper.clientHeight)&&(x.lastSizeC=x.wrapper.clientHeight),x.showingFrom=i,x.showingTo=n,M(t,100),o=x.lineDiv.offsetTop,l=x.lineDiv.firstChild;l;l=l.nextSibling)if(l.lineObj&&(Ln?(h=l.offsetTop+l.offsetHeight,u=h-o,o=h):(d=Sr(l),u=d.bottom-d.top),m=l.lineObj.height-u,2>u&&(u=B(x)),(.001<m||-.001>m)&&(Pe(l.lineObj,u),g=l.lineObj.widgets)))for(c=0;c<g.length;++c)g[c].height=g[c].node.offsetHeight;return y(t),f(x,w,r).to>n&&v(t,[],r),!0}y(t)}}else x.showingFrom=x.showingTo=w.first,x.viewOffset=0}function y(t){var e=t.display.viewOffset=Ve(t,ze(t.doc,t.display.showingFrom));t.display.mover.style.top=e+"px"}function b(t,e){for(var r,n,i,o=0,l=e.length||0;o<l;++o){var s=e[o],a=[],c=s.diff||0;for(r=0,n=t.length;r<n;++r)i=t[r],s.to<=i.from&&s.diff?a.push({from:i.from+c,to:i.to+c}):s.to<=i.from||s.from>=i.to?a.push(i):(s.from>i.from&&a.push({from:i.from,to:s.from}),s.to<i.to&&a.push({from:s.to+c,to:i.to+c}));t=a}return t}function x(t){for(var e=t.display,r={},n={},i=e.gutters.firstChild,o=0;i;i=i.nextSibling,++o)r[t.options.gutters[o]]=i.offsetLeft,n[t.options.gutters[o]]=i.offsetWidth;return{fixedPos:m(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:e.wrapper.clientWidth}}function C(t,e,r,n,i){function o(e){var r=e.nextSibling;return Sn&&In&&t.display.currentWheelTarget==e?(e.style.display="none",e.lineObj=null):e.parentNode.removeChild(e),r}var l,s,a,c,u=x(t),h=t.display,f=t.options.lineNumbers;for(n.length||Sn&&t.display.currentWheelTarget||wr(h.lineDiv),l=h.lineDiv,s=l.firstChild,a=n.shift(),c=e,t.doc.iter(e,r,function(e){var r,h,d,p,m;if(a&&a.to==c&&(a=n.shift()),de(t.doc,e)){if(0!=e.height&&Pe(e,0),e.widgets&&s.previousSibling)for(r=0;r<e.widgets.length;++r)e.widgets[r].showIfHidden&&(h=s.previousSibling,/pre/i.test(h.nodeName)&&(d=Cr("div",null,null,"position: relative"),h.parentNode.replaceChild(d,h),d.appendChild(h),h=d),p=h.appendChild(Cr("div",[e.widgets[r].node],"CodeMirror-linewidget")),w(e.widgets[r],p,h,u))}else if(a&&a.from<=c&&a.to>c){for(;s.lineObj!=e;)s=o(s);f&&i<=c&&s.lineNumber&&kr(s.lineNumber,""+t.options.lineNumberFormatter(c+t.options.firstLineNumber)),s=s.nextSibling}else{if(e.widgets)for(h=0,d=s;d&&20>h;++h,d=d.nextSibling)if(d.lineObj==e&&/div/i.test(d.nodeName)){r=d;break}var g;h=t;var v=c;p=r,d=Me(h,e);var y,b,x,C,L,k,S,M,T,N=e.gutterMarkers,A=h.display;if(h.options.lineNumbers||N||e.bgClass||e.wrapClass||e.widgets){if(p){for(p.alignable=null,y=!0,b=0,x=p.firstChild;x;x=C)if(C=x.nextSibling,/\bCodeMirror-linewidget\b/.test(x.className)){for(T=0,L=!0;T<e.widgets.length;++T)if(M=e.widgets[T],k=!1,M.above||(k=L,L=!1),M.node==x.firstChild){w(M,x,p,u),++b,k&&p.insertBefore(d,x);break}if(T==e.widgets.length){y=!1;break}}else p.removeChild(x);y&&b==e.widgets.length&&(g=p,p.className=e.wrapClass||"")}if(g||(g=Cr("div",null,e.wrapClass,"position: relative"),g.appendChild(d)),e.bgClass&&g.insertBefore(Cr("div","\xa0",e.bgClass+" CodeMirror-linebackground"),g.firstChild),(h.options.lineNumbers||N)&&(S=g.insertBefore(Cr("div",null,null,"position: absolute; left: "+(h.options.fixedGutter?u.fixedPos:-u.gutterTotalWidth)+"px"),g.firstChild),h.options.fixedGutter&&(g.alignable||(g.alignable=[])).push(S),!h.options.lineNumbers||N&&N["CodeMirror-linenumbers"]||(g.lineNumber=S.appendChild(Cr("div",""+h.options.lineNumberFormatter(v+h.options.firstLineNumber),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+u.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+A.lineNumInnerWidth+"px"))),N))for(M=0;M<h.options.gutters.length;++M)T=h.options.gutters[M],(v=N.hasOwnProperty(T)&&N[T])&&S.appendChild(Cr("div",[v],"CodeMirror-gutter-elt","left: "+u.gutterLeft[T]+"px; width: "+u.gutterWidth[T]+"px"));if(Ln&&(g.style.zIndex=2),e.widgets&&g!=p)for(T=0,p=e.widgets;T<p.length;++T)M=p[T],N=Cr("div",[M.node],"CodeMirror-linewidget"),w(M,N,g,u),M.above?g.insertBefore(N,h.options.lineNumbers&&0!=e.height?S:d):g.appendChild(N),sr(M,"redraw")}else g=d;if(m=g,m!=r)l.insertBefore(m,s);else{for(;s!=r;)s=o(s);s=s.nextSibling}m.lineObj=e}++c});s;)s=o(s)}function w(t,e,r,n){t.noHScroll&&((r.alignable||(r.alignable=[])).push(e),r=n.wrapperWidth,e.style.left=n.fixedPos+"px",t.coverGutter||(r-=n.gutterTotalWidth,e.style.paddingLeft=n.gutterTotalWidth+"px"),e.style.width=r+"px"),t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-n.gutterTotalWidth+"px"))}function L(t){var e=t.display,r=At(t.doc.sel.from,t.doc.sel.to);if(r||t.options.showCursorWhenSelecting){var n=t.display,i=z(t,t.doc.sel.head,"div");n.cursor.style.left=i.left+"px",n.cursor.style.top=i.top+"px",n.cursor.style.height=Math.max(0,i.bottom-i.top)*t.options.cursorHeight+"px",n.cursor.style.display="",i.other?(n.otherCursor.style.display="",n.otherCursor.style.left=i.other.left+"px",n.otherCursor.style.top=i.other.top+"px",n.otherCursor.style.height=.85*(i.other.bottom-i.other.top)+"px"):n.otherCursor.style.display="none"}else e.cursor.style.display=e.otherCursor.style.display="none";r?e.selectionDiv.style.display="none":k(t),t=z(t,t.doc.sel.head,"div"),r=Sr(e.wrapper),n=Sr(e.lineDiv),e.inputDiv.style.top=Math.max(0,Math.min(e.wrapper.clientHeight-10,t.top+n.top-r.top))+"px",e.inputDiv.style.left=Math.max(0,Math.min(e.wrapper.clientWidth-10,t.left+n.left-r.left))+"px"}function k(t){function e(t,e,r,n){0>e&&(e=0),c.appendChild(Cr("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px; top: "+e+"px; width: "+(null==r?u-t:r)+"px; height: "+(n-e)+"px"))}function r(r,n,i,o){var l=ze(s,r),a=l.text.length,c=o?1/0:-(1/0);return Nr(Ke(l),n||0,null==i?a:i,function(s,f,d){var p=E(t,Nt(r,"rtl"==d?f-1:s),"div",l),d=E(t,Nt(r,"rtl"==d?s:f-1),"div",l),m=p.left,g=d.right;3<d.top-p.top&&(e(m,p.top,null,p.bottom),m=h,p.bottom<d.top&&e(m,p.bottom,null,d.top)),null==i&&f==a&&(g=u),null==n&&0==s&&(m=h),c=o?Math.min(d.top,c):Math.max(d.bottom,c),m<h+1&&(m=h),e(m,d.top,g-m,d.bottom)}),c}var n,i,o,l=t.display,s=t.doc,a=t.doc.sel,c=document.createDocumentFragment(),u=l.lineSpace.offsetWidth,h=Lr(t.display.measure,Cr("pre",null,null,"text-align: left")).appendChild(Cr("span","x")).offsetLeft;if(a.from.line==a.to.line)r(a.from.line,a.from.ch,a.to.ch);else{var f=i=ze(s,a.from.line);o=[a.from.line,a.from.ch];for(var d;f=he(f);){if(n=f.find(),o.push(n.from.ch,n.to.line,n.to.ch),n.to.line==a.to.line){o.push(a.to.ch),d=!0;break}f=ze(s,n.to.line)}if(d)for(a=0;a<o.length;a+=3)r(o[a],o[a+1],o[a+2]);else o=ze(s,a.to.line),i=a.from.ch?r(a.from.line,a.from.ch,null,!1):Ve(t,i)-l.viewOffset,a=a.to.ch?r(a.to.line,ue(o,-1)?null:0,a.to.ch,!0):Ve(t,o)-l.viewOffset,i<a&&e(h,i,null,a)}Lr(l.selectionDiv,c),l.selectionDiv.style.display=""}function S(t){var e,r=t.display;clearInterval(r.blinker),e=!0,r.cursor.style.visibility=r.otherCursor.style.visibility="",r.blinker=setInterval(function(){r.cursor.offsetHeight&&(r.cursor.style.visibility=r.otherCursor.style.visibility=(e=!e)?"":"hidden")},t.options.cursorBlinkRate)}function M(t,e){t.doc.mode.startState&&t.doc.frontier<t.display.showingTo&&t.state.highlight.set(e,yr(T,t))}function T(t){var e=t.doc;if(e.frontier<e.first&&(e.frontier=e.first),!(e.frontier>=t.display.showingTo)){var r,n=+new Date+t.options.workTime,i=$t(e.mode,A(t,e.frontier)),o=[];e.iter(e.frontier,Math.min(e.first+e.size,t.display.showingTo+500),function(l){var s,a,c;if(e.frontier>=t.display.showingFrom){for(s=l.styles,l.styles=Le(t,l,i),a=!s||s.length!=l.styles.length,c=0;!a&&c<s.length;++c)a=s[c]!=l.styles[c];a&&(r&&r.end==e.frontier?r.end++:o.push(r={start:e.frontier,end:e.frontier+1})),l.stateAfter=$t(e.mode,i)}else ke(t,l,i),l.stateAfter=0==e.frontier%5?$t(e.mode,i):null;return++e.frontier,+new Date>n?(M(t,t.options.workDelay),!0):void 0}),o.length&&G(t,function(){for(var t=0;t<o.length;++t)Y(this,o[t].start,o[t].end)})()}}function N(t,e){for(var r,n,i,o,l=t.doc,s=e,a=e-100;s>a;--s){if(s<=l.first)return l.first;if(i=ze(l,s-1),i.stateAfter)return s;o=hr(i.text,null,t.options.tabSize),(null==n||r>o)&&(n=s-1,r=o)}return n}function A(t,e){var r,n,i=t.doc,o=t.display;return!i.mode.startState||(r=N(t,e),n=r>i.first&&ze(i,r-1).stateAfter,n=n?$t(i.mode,n):Zt(i.mode),i.iter(r,e,function(l){ke(t,l,n),l.stateAfter=r==e-1||0==r%5||r>=o.showingFrom&&r<o.showingTo?$t(i.mode,n):null,++r}),n)}function W(t,e,r,n){for(var i,o=-1,n=n||O(t,e),t=r;!(i=n[t]);t+=o)0>o&&0==t&&(o=1);return{left:t<r?i.right:i.left,right:t>r?i.left:i.right,top:i.top,bottom:i.bottom}}function O(t,e){for(var r,n,i=t.display,o=t.display.measureLineCache,l=0;l<o.length;++l)if(n=o[l],n.text==e.text&&n.markedSpans==e.markedSpans&&i.scroller.clientWidth==n.width&&n.classes==e.textClass+"|"+e.bgClass+"|"+e.wrapClass)return n.measure;var s,a,c,u,h,f,d,p,m,g,v=t.display,l=vr(e.text.length),y=Me(t,e,l);if(wn&&!Ln&&!t.options.lineWrapping&&100<y.childNodes.length){var b=document.createDocumentFragment(),x=y.childNodes.length;for(d=0,s=Math.ceil(x/10);d<s;++d){for(a=Cr("div",null,null,"display: inline-block"),c=0;10>c&&x;++c)a.appendChild(y.firstChild),--x;b.appendChild(a)}y.appendChild(b)}for(Lr(v.measure,y),s=Sr(v.lineDiv),a=[],b=vr(e.text.length),x=y.offsetHeight,kn&&v.measure.first!=y&&Lr(v.measure,y),d=0;d<l.length;++d)if(p=l[d]){v=Sr(p),f=Math.max(0,v.top-s.top);var C=Math.min(v.bottom-s.top,x);for(c=0;c<a.length;c+=2)if(u=a[c],h=a[c+1],!(u>C||h<f)&&(u<=f&&h>=C||f<=u&&C>=h||Math.min(C,h)-Math.max(f,u)>=C-f>>1)){a[c]=Math.min(f,u),a[c+1]=Math.max(C,h);break}c==a.length&&a.push(f,C),f=v.right,p.measureRight&&(f=Sr(p.measureRight).left),b[d]={left:v.left-s.left,right:f-s.left,top:c}}for(d=0;d<b.length;++d)(p=b[d])&&(m=p.top,p.top=a[m],p.bottom=a[m+1]);return t.options.lineWrapping||(g=y.lastChild,3==g.nodeType&&(g=y.appendChild(Cr("span","\u200b"))),b.width=Sr(g).right-s.left),r=b,n={text:e.text,width:i.scroller.clientWidth,markedSpans:e.markedSpans,measure:r,classes:e.textClass+"|"+e.bgClass+"|"+e.wrapClass},16==o.length?o[++i.measureLineCachePos%16]=n:o.push(n),r}function D(t){t.display.measureLineCache.length=t.display.measureLineCachePos=0,t.display.cachedCharWidth=t.display.cachedTextHeight=null,t.display.maxLineChanged=!0,t.display.lineNumChars=null}function H(t,e,r,n){var i,o,l,s,a;if(e.widgets)for(i=0;i<e.widgets.length;++i)e.widgets[i].above&&(o=ye(e.widgets[i]),r.top+=o,r.bottom+=o);return"line"==n?r:(n||(n="local"),l=Ve(t,e),"local"!=n&&(l-=t.display.viewOffset),"page"==n&&(s=Sr(t.display.lineSpace),l+=s.top+(window.pageYOffset||(document.documentElement||document.body).scrollTop),a=s.left+(window.pageXOffset||(document.documentElement||document.body).scrollLeft),r.left+=a,r.right+=a),r.top+=l,r.bottom+=l,r)}function E(t,e,r,n){return n||(n=ze(t.doc,e.line)),H(t,n,W(t,n,e.ch),r)}function z(t,e,r,n,i){function o(e,o){var l=W(t,n,e,i);return o?l.left=l.right:l.right=l.left,H(t,n,l,r)}var l,s,a,c,u,h,f,d,p,m;if(n=n||ze(t.doc,e.line),i||(i=O(t,n)),l=Ke(n),e=e.ch,!l)return o(e);for(c=l[0].level,u=0;u<l.length;++u){if(h=l[u],f=h.level%2,h.from<e&&h.to>e)return o(e,f);p=f?h.to:h.from,d=f?h.from:h.to,p==e?(d=u&&h.level<(m=l[u-1]).level?o(m.level%2?m.from:m.to-1,!0):o(f&&h.from!=h.to?e-1:e),f==c?s=d:a=d):d!=e||(m=u<l.length-1&&l[u+1],!f&&m&&m.from==m.to)||(d=m&&h.level<m.level?o(m.level%2?m.to-1:m.from):o(f?e:e-1,!0),f==c?s=d:a=d)}return c&&!e&&(a=o(l[0].to-1)),s?(a&&(s.other=a),s):a}function I(t,e,r){return t=new Nt(t,e),r&&(t.outside=!0),t}function F(t,e,r){var n,i,o=t.doc;if(r+=t.display.viewOffset,0>r)return I(o.first,0,!0);if(n=Re(o,r),i=o.first+o.size-1,n>i)return I(o.first+o.size-1,ze(o,i).text.length,!0);for(0>e&&(e=0);;){i=ze(o,n),n=P(t,i,n,e,r);var l=(i=he(i))&&i.find();if(!(i&&n.ch>=l.from.ch))return n;n=l.to.line}}function P(t,e,r,n,i){function o(n){return n=z(t,Nt(r,n),"line",e,d),h=!0,u>n.bottom?Math.max(0,n.left-f):u<n.top?n.left+f:(h=!1,n.left)}var l,s,a,c,u=i-Ve(t,e),h=!1,f=t.display.wrapper.clientWidth,d=O(t,e),p=Ke(e),m=e.text.length,g=Wr(e),v=Or(e),y=o(g),i=h,b=o(v),x=h;if(n>b)return I(r,v,x);for(;;){if(p?v==g||v==Er(e,g,1):1>=v-g){for(g=(n=n-y<b-n)?g:v;pn.test(e.text.charAt(g));)++g;return l=I(r,g,n?i:x),l.after=n,l}if(s=Math.ceil(m/2),a=g+s,p)for(a=g,c=0;c<s;++c)a=Er(e,a,1);c=o(a),c>n?(v=a,b=c,(x=h)&&(b+=1e3),m-=s):(g=a,y=c,i=h,m=s)}}function B(t){var e,r;if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==Ir){for(Ir=Cr("pre"),e=0;49>e;++e)Ir.appendChild(document.createTextNode("x")),Ir.appendChild(Cr("br"));Ir.appendChild(document.createTextNode("x"))}return Lr(t.measure,Ir),r=Ir.offsetHeight/50,3<r&&(t.cachedTextHeight=r),wr(t.measure),r||1}function R(t){var e,r,n;return null!=t.cachedCharWidth?t.cachedCharWidth:(e=Cr("span","x"),r=Cr("pre",[e]),Lr(t.measure,r),n=e.offsetWidth,2<n&&(t.cachedCharWidth=n),n||10)}function V(t){t.curOp={changes:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Fr},cn++||(an=[])}function K(t){var e,r,n,i,o,l,s,a,u=t.curOp,h=t.doc,f=t.display;if(t.curOp=null,u.updateMaxLine&&c(t),f.maxLineChanged&&!t.options.lineWrapping&&(e=O(t,f.maxLine).width,f.sizer.style.minWidth=Math.max(0,e+3+un)+"px",f.maxLineChanged=!1,r=Math.max(0,f.sizer.offsetLeft+f.sizer.offsetWidth-f.scroller.clientWidth),r<h.scrollLeft&&!u.updateScrollPos&&lt(t,Math.min(f.scroller.scrollLeft,r),!0)),u.updateScrollPos?n=u.updateScrollPos:u.selectionChanged&&f.scroller.clientHeight&&(o=z(t,h.sel.head),n=Vt(t,o.left,o.top,o.left,o.bottom)),(u.changes.length||n&&null!=n.scrollTop)&&(i=g(t,u.changes,n&&n.scrollTop)),!i&&u.selectionChanged&&L(t),u.updateScrollPos?(f.scroller.scrollTop=f.scrollbarV.scrollTop=h.scrollTop=n.scrollTop,f.scroller.scrollLeft=f.scrollbarH.scrollLeft=h.scrollLeft=n.scrollLeft,d(t)):n&&(h=Bt(t,t.doc.sel.head),t.state.focused&&(f=t.display,e=Sr(f.sizer),r=null,0>h.top+e.top?r=!0:h.bottom+e.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null==r||Hn||(s="none"==f.cursor.style.display,s&&(f.cursor.style.display="",f.cursor.style.left=h.left+"px",f.cursor.style.top=h.top-f.viewOffset+"px"),f.cursor.scrollIntoView(r),s&&(f.cursor.style.display="none")))),u.selectionChanged&&S(t),t.state.focused&&u.updateInput&&Z(t,u.userSelChange),l=u.maybeHiddenMarkers,s=u.maybeUnhiddenMarkers,l)for(h=0;h<l.length;++h)l[h].lines.length||lr(l[h],"hide");if(s)for(h=0;h<s.length;++h)s[h].lines.length&&lr(s[h],"unhide");if(--cn||(a=an,an=null),u.textChanged&&lr(t,"change",t,u.textChanged),u.selectionChanged&&lr(t,"cursorActivity",t),a)for(h=0;h<a.length;++h)a[h]()}function G(t,e){return function(){var r,n=t||this,i=!n.curOp;i&&V(n);try{r=e.apply(n,arguments)}finally{i&&K(n)}return r}}function X(t){return function(){var e,r=this.cm&&!this.cm.curOp;r&&V(this.cm);try{e=t.apply(this,arguments)}finally{r&&K(this.cm)}return e}}function U(t,e){var r,n=!t.curOp;n&&V(t);try{r=e()}finally{n&&K(t)}return r}function Y(t,e,r,n){null==e&&(e=t.doc.first),null==r&&(r=t.doc.first+t.doc.size),t.curOp.changes.push({from:e,to:r,diff:n})}function _(t){t.display.pollingFast||t.display.poll.set(t.options.pollInterval,function(){$(t),t.state.focused&&_(t)})}function j(t){function e(){$(t)||r?(t.display.pollingFast=!1,_(t)):(r=!0,t.display.poll.set(60,e))}var r=!1;t.display.pollingFast=!0,t.display.poll.set(20,e)}function $(t){var e,r,n,i,o,l,s,a=t.display.input,c=t.display.prevInput,u=t.doc,h=u.sel;if(!t.state.focused||Gn(a)||J(t)||(e=a.value,e==c&&At(h.from,h.to)))return!1;if(wn&&e&&0===a.selectionStart)return Z(t,!0),!1;for((r=!t.curOp)&&V(t),h.shift=!1,n=0,i=Math.min(c.length,e.length);n<i&&c[n]==e[n];)++n;return o=h.from,l=h.to,n<c.length?o=Nt(o.line,o.ch-(c.length-n)):t.state.overwrite&&At(o,l)&&!t.state.pasteIncoming&&(l=Nt(l.line,Math.min(ze(u,l.line).text.length,l.ch+(e.length-n)))),s=t.curOp.updateInput,Ct(t.doc,{from:o,to:l,text:bn(e.slice(n)),origin:t.state.pasteIncoming?"paste":"+input"},"end"),t.curOp.updateInput=s,1e3<e.length?a.value=t.display.prevInput="":t.display.prevInput=e,r&&K(t),t.state.pasteIncoming=!1,!0}function Z(t,e){var r,n,i=t.doc;At(i.sel.from,i.sel.to)?e&&(t.display.prevInput=t.display.input.value=""):(t.display.prevInput="",r=Xn&&(100<i.sel.to.line-i.sel.from.line||1e3<(n=t.getSelection()).length),t.display.input.value=r?"-":n||t.getSelection(),t.state.focused&&pr(t.display.input)),t.display.inaccurateSelection=r}function q(t){"nocursor"==t.options.readOnly||zn&&document.activeElement==t.display.input||t.display.input.focus()}function J(t){return t.options.readOnly||t.doc.cantEdit}function Q(t){function e(){t.state.focused&&setTimeout(yr(q,t),0)}function r(){l.cachedCharWidth=l.cachedTextHeight=null,D(t),U(t,yr(Y,t))}function n(){for(var t=l.wrapper.parentNode;t&&t!=document.body;t=t.parentNode);t?setTimeout(n,5e3):or(window,"resize",r)}function i(e){t.options.onDragEvent&&t.options.onDragEvent(t,Qe(e))||rr(e)}function o(){l.inaccurateSelection&&(l.prevInput="",l.inaccurateSelection=!1,l.input.value=t.getSelection(),pr(l.input))}var l=t.display;ir(l.scroller,"mousedown",G(t,rt)),ir(l.scroller,"dblclick",G(t,tr)),ir(l.lineSpace,"selectstart",function(t){tt(l,t)||tr(t)}),Rn||ir(l.scroller,"contextmenu",function(e){gt(t,e)}),ir(l.scroller,"scroll",function(){ot(t,l.scroller.scrollTop),lt(t,l.scroller.scrollLeft,!0),lr(t,"scroll",t)}),ir(l.scrollbarV,"scroll",function(){ot(t,l.scrollbarV.scrollTop)}),ir(l.scrollbarH,"scroll",function(){lt(t,l.scrollbarH.scrollLeft)}),ir(l.scroller,"mousewheel",function(e){st(t,e)}),ir(l.scroller,"DOMMouseScroll",function(e){st(t,e)}),ir(l.scrollbarH,"mousedown",e),ir(l.scrollbarV,"mousedown",e),ir(l.wrapper,"scroll",function(){l.wrapper.scrollTop=l.wrapper.scrollLeft=0}),ir(window,"resize",r),setTimeout(n,5e3),ir(l.input,"keyup",G(t,function(e){t.options.onKeyEvent&&t.options.onKeyEvent(t,Qe(e))||16==e.keyCode&&(t.doc.sel.shift=!1)})),ir(l.input,"input",yr(j,t)),ir(l.input,"keydown",G(t,ft)),ir(l.input,"keypress",G(t,dt)),ir(l.input,"focus",yr(pt,t)),ir(l.input,"blur",yr(mt,t)),t.options.dragDrop&&(ir(l.scroller,"dragstart",function(e){var r,n,i=t;tt(i.display,e)||(r=i.getSelection(),e.dataTransfer.setData("Text",r),e.dataTransfer.setDragImage&&!An&&(n=Cr("img",null,null,"position: fixed; left: 0; top: 0;"),Nn&&(n.width=n.height=1,i.display.wrapper.appendChild(n),n._top=n.offsetTop),e.dataTransfer.setDragImage(n,0,0),Nn&&n.parentNode.removeChild(n)))}),ir(l.scroller,"dragenter",i),ir(l.scroller,"dragover",i),ir(l.scroller,"drop",G(t,nt))),ir(l.scroller,"paste",function(e){tt(l,e)||(q(t),j(t))}),ir(l.input,"paste",function(){t.state.pasteIncoming=!0,j(t)}),ir(l.input,"cut",o),ir(l.input,"copy",o),Wn&&ir(l.sizer,"mouseup",function(){document.activeElement==l.input&&l.input.blur(),q(t)})}function tt(t,e){for(var r=e.target||e.srcElement;r!=t.wrapper;r=r.parentNode)if(!r||/\bCodeMirror-(?:line)?widget\b/.test(r.className)||r.parentNode==t.sizer&&r!=t.mover)return!0}function et(t,e,r){var n,i,o,l=t.display;if(!r&&(n=e.target||e.srcElement,n==l.scrollbarH||n==l.scrollbarH.firstChild||n==l.scrollbarV||n==l.scrollbarV.firstChild||n==l.scrollbarFiller))return null;r=Sr(l.lineSpace);try{i=e.clientX,o=e.clientY}catch(t){return null}return F(t,i-r.left,o-r.top)}function rt(t){function e(t){if("single"==l)zt(v.doc,Dt(b,i),t);else if(u=Dt(b,u),h=Dt(b,h),"double"==l){var e=Yt(ze(b,t.line).text,t);Wt(t,u)?zt(v.doc,e.from,h):zt(v.doc,u,e.to)}else"triple"==l&&(Wt(t,u)?zt(v.doc,h,Dt(b,Nt(t.line,0))):zt(v.doc,u,Dt(b,Nt(t.line+1,0))))}function r(t){var n,i,o=++p,l=et(v,t,!0);l&&(At(l,a)?(i=t.clientY<d.top?-20:t.clientY>d.bottom?20:0,i&&setTimeout(G(v,function(){p==o&&(y.scroller.scrollTop+=i,r(t))}),50)):(v.state.focused||pt(v),a=l,e(l),n=f(y,b),(l.line>=n.to||l.line<n.from)&&setTimeout(G(v,function(){p==o&&r(t)}),150)))}function n(t){p=1/0;var r=et(v,t);r&&e(r),tr(t),q(v),or(document,"mousemove",m),or(document,"mouseup",g)}var i,o,l,s,a,c,u,h,d,p,m,g,v=this,y=v.display,b=v.doc,x=b.sel;if(x.shift=t.shiftKey,tt(y,t))Sn||(y.scroller.draggable=!1,setTimeout(function(){y.scroller.draggable=!0},100));else if(!it(v,t)){switch(i=et(v,t),nr(t)){case 3:return void(Rn&&gt.call(v,v,t));case 2:return i&&zt(v.doc,i),setTimeout(yr(q,v),20),void tr(t)}i?(v.state.focused||pt(v),o=+new Date,l="single",Br&&Br.time>o-400&&At(Br.pos,i)?(l="triple",tr(t),setTimeout(yr(q,v),20),_t(v,i.line)):Pr&&Pr.time>o-400&&At(Pr.pos,i)?(l="double",Br={time:o,pos:i},tr(t),s=Yt(ze(b,i.line).text,i),zt(v.doc,s.from,s.to)):Pr={time:o,pos:i},a=i,!v.options.dragDrop||!mn||J(v)||At(x.from,x.to)||Wt(i,x.from)||Wt(x.to,i)||"single"!=l?(tr(t),"single"==l&&zt(v.doc,Dt(b,i)),u=x.from,h=x.to,d=Sr(y.wrapper),p=0,m=G(v,function(t){wn||nr(t)?r(t):n(t)}),g=G(v,n),ir(document,"mousemove",m),ir(document,"mouseup",g)):(c=G(v,function(e){Sn&&(y.scroller.draggable=!1),v.state.draggingText=!1,or(document,"mouseup",c),or(y.scroller,"drop",c),10>Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)&&(tr(e),zt(v.doc,i),q(v))}),Sn&&(y.scroller.draggable=!0),v.state.draggingText=c,y.scroller.dragDrop&&y.scroller.dragDrop(),ir(document,"mouseup",c),ir(y.scroller,"drop",c))):(t.target||t.srcElement)==y.scroller&&tr(t)}}function nt(t){var e,r,n,i,o,l=this;if(!tt(l.display,t)&&(!l.options.onDragEvent||!l.options.onDragEvent(l,Qe(t)))&&(tr(t),e=et(l,t,!0),r=t.dataTransfer.files,e&&!J(l)))if(r&&r.length&&window.FileReader&&window.File){var s=r.length;n=Array(s);var a=0;for(i=function(t,r){var i=new FileReader;i.onload=function(){n[r]=i.result,++a==s&&(e=Dt(l.doc,e),Tt(l.doc,n.join(""),e,"around","paste"))},i.readAsText(t)},t=0;t<s;++t)i(r[t],t)}else if(!l.state.draggingText||Wt(e,l.doc.sel.from)||Wt(l.doc.sel.to,e))try{(n=t.dataTransfer.getData("Text"))&&(i=l.doc.sel.from,o=l.doc.sel.to,It(l.doc,e,e),l.state.draggingText&&Tt(l.doc,"",i,o,"paste"),l.replaceSelection(n,null,"paste"),q(l),pt(l))}catch(t){}else l.state.draggingText(t),setTimeout(yr(q,l),20)}function it(t,e){var r,n,i,o,l=t.display;try{r=e.clientX,n=e.clientY}catch(t){return!1}if(r>=Math.floor(Sr(l.gutters).right))return!1;if(tr(e),!cr(t,"gutterClick")||(i=Sr(l.lineDiv),n>i.bottom))return!0;for(n-=i.top-l.viewOffset,i=0;i<t.options.gutters.length;++i)if(o=l.gutters.childNodes[i],o&&Sr(o).right>=r){l=Re(t.doc,n),r=t.options.gutters[i],sr(t,"gutterClick",t,l,r,e);break}return!0}function ot(t,e){2>Math.abs(t.doc.scrollTop-e)||(t.doc.scrollTop=e,Cn||g(t,[],e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e),t.display.scrollbarV.scrollTop!=e&&(t.display.scrollbarV.scrollTop=e),Cn&&g(t,[]))}function lt(t,e,r){(r?e==t.doc.scrollLeft:2>Math.abs(t.doc.scrollLeft-e))||(e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),t.doc.scrollLeft=e,d(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbarH.scrollLeft!=e&&(t.display.scrollbarH.scrollLeft=e))}function st(t,e){var r,n,i,o=e.wheelDeltaX,l=e.wheelDeltaY;if(null==o&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(o=e.detail),null==l&&e.detail&&e.axis==e.VERTICAL_AXIS?l=e.detail:null==l&&(l=e.wheelDelta),l&&In&&Sn)for(r=e.target;r!=i;r=r.parentNode)if(r.lineObj){t.display.currentWheelTarget=r;break}if(n=t.display,i=n.scroller,!o||Cn||Nn||null==Vr){if(l&&null!=Vr){r=l*Vr;var s=t.doc.scrollTop,a=s+n.wrapper.clientHeight;0>r?s=Math.max(0,s+r-50):a=Math.min(t.doc.height,a+r+50),g(t,[],{top:s,bottom:a})}20>Rr&&(null==n.wheelStartX?(n.wheelStartX=i.scrollLeft,n.wheelStartY=i.scrollTop,n.wheelDX=o,n.wheelDY=l,setTimeout(function(){if(null!=n.wheelStartX){var t=i.scrollLeft-n.wheelStartX,e=i.scrollTop-n.wheelStartY,t=e&&n.wheelDY&&e/n.wheelDY||t&&n.wheelDX&&t/n.wheelDX;n.wheelStartX=n.wheelStartY=null,t&&(Vr=(Vr*Rr+t)/(Rr+1),++Rr)}},200)):(n.wheelDX+=o,n.wheelDY+=l))}else l&&ot(t,Math.max(0,Math.min(i.scrollTop+l*Vr,i.scrollHeight-i.clientHeight))),lt(t,Math.max(0,Math.min(i.scrollLeft+o*Vr,i.scrollWidth-i.clientWidth))),tr(e),n.wheelStartX=null}function at(t,e,r){if("string"==typeof e&&(e=Jr[e],!e))return!1;t.display.pollingFast&&$(t)&&(t.display.pollingFast=!1);var n=t.doc,i=n.sel.shift,o=!1;try{J(t)&&(t.state.suppressEdits=!0),r&&(n.sel.shift=!1),o=e(t)!=hn}finally{n.sel.shift=i,t.state.suppressEdits=!1}return o}function ct(t){var e=t.state.keyMaps.slice(0);return e.push(t.options.keyMap),t.options.extraKeys&&e.unshift(t.options.extraKeys),e}function ut(t,e){var r,n,i,o=qt(t.options.keyMap),l=o.auto;return clearTimeout(Kr),l&&!Qt(e)&&(Kr=setTimeout(function(){qt(t.options.keyMap)==o&&(t.options.keyMap=l.call?l.call(null,t):l)},50)),r=te(e,!0),n=!1,!!r&&(i=ct(t),n=e.shiftKey?Jt("Shift-"+r,i,function(e){
return at(t,e,!0)})||Jt(r,i,function(e){if("string"==typeof e&&/^go[A-Z]/.test(e))return at(t,e)}):Jt(r,i,function(e){return at(t,e)}),"stop"==n&&(n=!1),n&&(tr(e),S(t),kn&&(e.oldKeyCode=e.keyCode,e.keyCode=0)),n)}function ht(t,e,r){return r=Jt("'"+r+"'",ct(t),function(e){return at(t,e,!0)}),r&&(tr(e),S(t)),r}function ft(t){var e,r;this.state.focused||pt(this),wn&&27==t.keyCode&&(t.returnValue=!1),this.options.onKeyEvent&&this.options.onKeyEvent(this,Qe(t))||(e=t.keyCode,this.doc.sel.shift=16==e||t.shiftKey,r=ut(this,t),Nn&&(Gr=r?e:null,r||88!=e||Xn||!(In?t.metaKey:t.ctrlKey)||this.replaceSelection("")))}function dt(t){var e,r,n,i=this;i.options.onKeyEvent&&i.options.onKeyEvent(i,Qe(t))||(e=t.keyCode,r=t.charCode,Nn&&e==Gr?(Gr=null,tr(t)):(Nn&&(!t.which||10>t.which)||Wn)&&ut(i,t)||(n=String.fromCharCode(null==r?e:r),this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!J(this)&&-1<this.doc.mode.electricChars.indexOf(n)&&setTimeout(G(i,function(){Kt(i,i.doc.sel.to.line,"smart")}),75),ht(i,t,n))||j(i))}function pt(t){"nocursor"!=t.options.readOnly&&(t.state.focused||(lr(t,"focus",t),t.state.focused=!0,-1==t.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(t.display.wrapper.className+=" CodeMirror-focused"),Z(t,!0)),_(t),S(t))}function mt(t){t.state.focused&&(lr(t,"blur",t),t.state.focused=!1,t.display.wrapper.className=t.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(t.display.blinker),setTimeout(function(){t.state.focused||(t.doc.sel.shift=!1)},150)}function gt(t,e){function r(){var e,r,n;s.inputDiv.style.position="relative",s.input.style.cssText=o,kn&&(s.scrollbarV.scrollTop=s.scroller.scrollTop=i),_(t),null!=s.input.selectionStart&&(!wn||kn)&&(clearTimeout(Xr),e=s.input.value=" "+(At(a.from,a.to)?"":s.input.value),r=0,s.prevInput=" ",s.input.selectionStart=1,s.input.selectionEnd=e.length,n=function(){" "==s.prevInput&&0==s.input.selectionStart?G(t,Jr.selectAll)(t):10>r++?Xr=setTimeout(n,500):Z(t)},Xr=setTimeout(n,200))}var n,i,o,l,s=t.display,a=t.doc.sel;tt(s,e)||(n=et(t,e),i=s.scroller.scrollTop,n&&!Nn&&((At(a.from,a.to)||Wt(n,a.from)||!Wt(n,a.to))&&G(t,It)(t.doc,n,n),o=s.input.style.cssText,s.inputDiv.style.position="absolute",s.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",q(t),Z(t,!0),At(a.from,a.to)&&(s.input.value=s.prevInput=" "),Rn?(rr(e),l=function(){or(window,"mouseup",l),setTimeout(r,20)},ir(window,"mouseup",l)):setTimeout(r,50)))}function vt(t){return Nt(t.from.line+t.text.length-1,dr(t.text).length+(1==t.text.length?t.from.ch:0))}function yt(t,e,r){var n,i,o,l;return Wt(e.from,r)?(n=e.text.length-1-(e.to.line-e.from.line),r.line>e.to.line+n?(i=r.line-n,o=t.first+t.size-1,i>o?Nt(o,ze(t,o).text.length):Ht(r,ze(t,i).text.length)):r.line==e.to.line+n?Ht(r,dr(e.text).length+(1==e.text.length?e.from.ch:0)+ze(t,e.to.line).text.length-e.to.ch):(l=r.line-e.from.line,Ht(r,e.text[l].length+(l?0:e.from.ch)))):Dt(t,r)}function bt(t,e,r){var n,i;return r&&"object"==typeof r?{anchor:yt(t,e,r.anchor),head:yt(t,e,r.head)}:"start"==r?{anchor:e.from,head:e.from}:(n=vt(e),"around"==r?{anchor:e.from,head:n}:"end"==r?{anchor:n,head:n}:(i=function(t){if(Wt(t,e.from))return t;if(!Wt(e.to,t))return n;var r=t.line+e.text.length-(e.to.line-e.from.line)-1,i=t.ch;return t.line==e.to.line&&(i+=n.ch-e.to.ch),Nt(r,i)},{anchor:i(t.sel.anchor),head:i(t.sel.head)}))}function xt(t,e){var r={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,update:function(e,r,n,i){e&&(this.from=Dt(t,e)),r&&(this.to=Dt(t,r)),n&&(this.text=n),void 0!==i&&(this.origin=i)},cancel:function(){this.canceled=!0}};return lr(t,"beforeChange",t,r),t.cm&&lr(t.cm,"beforeChange",t.cm,r),r.canceled?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function Ct(t,e,r,n){var i;if(t.cm){if(!t.cm.curOp)return G(t.cm,Ct)(t,e,r,n);if(t.cm.state.suppressEdits)return}if(!cr(t,"beforeChange")&&(!t.cm||!cr(t.cm,"beforeChange"))||(e=xt(t,e)))if(i=Vn&&!n&&ce(t,e.from,e.to)){for(n=i.length-1;1<=n;--n)wt(t,{from:i[n].from,to:i[n].to,text:[""]});i.length&&wt(t,{from:i[0].from,to:i[0].to,text:e.text},r)}else wt(t,e,r)}function wt(t,e,r){var n,r=bt(t,e,r);Ye(t,e,r,t.cm?t.cm.curOp.id:NaN),St(t,e,r,se(t,e)),n=[],He(t,function(t,r){r||-1!=mr(n,t.history)||(qe(t.history,e),n.push(t.history)),St(t,e,null,se(t,e))})}function Lt(t,e){var r,n,i,o,l=t.history,s=("undo"==e?l.done:l.undone).pop();if(s)for(l.dirtyCounter+="undo"==e?-1:1,r={changes:[],anchorBefore:s.anchorAfter,headBefore:s.headAfter,anchorAfter:s.anchorBefore,headAfter:s.headBefore},("undo"==e?l.undone:l.done).push(r),l=s.changes.length-1;0<=l;--l)n=s.changes[l],n.origin=e,r.changes.push(Ue(t,n)),i=l?bt(t,n,null):{anchor:s.anchorBefore,head:s.headBefore},St(t,n,i,ae(t,n)),o=[],He(t,function(t,e){e||-1!=mr(o,t.history)||(qe(t.history,n),o.push(t.history)),St(t,n,null,ae(t,n))})}function kt(t,e){function r(t){return Nt(t.line+e,t.ch)}t.first+=e,t.cm&&Y(t.cm,t.first,t.first,e),t.sel.head=r(t.sel.head),t.sel.anchor=r(t.sel.anchor),t.sel.from=r(t.sel.from),t.sel.to=r(t.sel.to)}function St(t,e,r,n){var i,o;return t.cm&&!t.cm.curOp?G(t.cm,St)(t,e,r,n):void(e.to.line<t.first?kt(t,e.text.length-1-(e.to.line-e.from.line)):e.from.line>t.lastLine()||(e.from.line<t.first&&(i=e.text.length-1-(t.first-e.from.line),kt(t,i),e={from:Nt(t.first,0),to:Nt(e.to.line+i,e.to.ch),text:[dr(e.text)],origin:e.origin}),o=t.lastLine(),e.to.line>o&&(e={from:e.from,to:Nt(o,ze(t,o).text.length),text:[e.text[0]],origin:e.origin}),r||(r=bt(t,e,null)),t.cm?Mt(t.cm,e,n,r):We(t,e,n,r)))}function Mt(t,e,r,i){var o,l=t.doc,s=t.display,c=e.from,u=e.to,h=!1,f=c.line;if(t.options.lineWrapping||(f=Be(fe(l,ze(l,c.line))),l.iter(f,u.line+1,function(t){if(t==s.maxLine)return h=!0,!0})),We(l,e,r,i,n(t)),t.options.lineWrapping||(l.iter(f,c.line+e.text.length,function(t){var e=a(l,t);e>s.maxLineLength&&(s.maxLine=t,s.maxLineLength=e,s.maxLineChanged=!0,h=!1)}),h&&(t.curOp.updateMaxLine=!0)),l.frontier=Math.min(l.frontier,c.line),M(t,400),o=e.text.length-(u.line-c.line)-1,Y(t,c.line,u.line+1,o),cr(t,"change"))if(e={from:c,to:u,text:e.text,origin:e.origin},t.curOp.textChanged){for(t=t.curOp.textChanged;t.next;t=t.next);t.next=e}else t.curOp.textChanged=e}function Tt(t,e,r,n,i){if(n||(n=r),Wt(n,r))var o=n,n=r,r=o;"string"==typeof e&&(e=bn(e)),Ct(t,{from:r,to:n,text:e,origin:i},null)}function Nt(t,e){return this instanceof Nt?(this.line=t,void(this.ch=e)):new Nt(t,e)}function At(t,e){return t.line==e.line&&t.ch==e.ch}function Wt(t,e){return t.line<e.line||t.line==e.line&&t.ch<e.ch}function Ot(t){return Nt(t.line,t.ch)}function Dt(t,e){if(e.line<t.first)return Nt(t.first,0);var r=t.first+t.size-1;return e.line>r?Nt(r,ze(t,r).text.length):Ht(e,ze(t,e.line).text.length)}function Ht(t,e){var r=t.ch;return null==r||r>e?Nt(t.line,e):0>r?Nt(t.line,0):t}function Et(t,e){return e>=t.first&&e<t.first+t.size}function zt(t,e,r,n){var i,o;t.sel.shift||t.sel.extend?(i=t.sel.anchor,r&&(o=Wt(e,i),o!=Wt(r,i)?(i=e,e=r):o!=Wt(e,r)&&(e=r)),It(t,i,e,n)):It(t,e,r||e,n),t.cm&&(t.cm.curOp.userSelChange=!0)}function It(t,e,r,n,i){var o,l;(!i&&cr(t,"beforeSelectionChange")||t.cm&&cr(t.cm,"beforeSelectionChange"))&&(r={anchor:e,head:r},lr(t,"beforeSelectionChange",t,r),t.cm&&lr(t.cm,"beforeSelectionChange",t.cm,r),r.anchor=Dt(t,r.anchor),r.head=Dt(t,r.head),e=r,r=e.head,e=e.anchor),o=t.sel,o.goalColumn=null,(i||!At(e,o.anchor))&&(e=Pt(t,e,n,"push"!=i)),(i||!At(r,o.head))&&(r=Pt(t,r,n,"push"!=i)),At(o.anchor,e)&&At(o.head,r)||(o.anchor=e,o.head=r,l=Wt(r,e),o.from=l?r:e,o.to=l?e:r,t.cm&&(t.cm.curOp.updateInput=t.cm.curOp.selectionChanged=!0),sr(t,"cursorActivity",t))}function Ft(t){It(t.doc,t.doc.sel.from,t.doc.sel.to,null,"push")}function Pt(t,e,r,n){var i,o,l,s,a,c,u=!1,h=e,f=r||1;t.cantEdit=!1;t:for(;;){if(i=ze(t,h.line),i.markedSpans){for(c=0;c<i.markedSpans.length;++c)if(l=i.markedSpans[c],s=l.marker,(null==l.from||(s.inclusiveLeft?l.from<=h.ch:l.from<h.ch))&&(null==l.to||(s.inclusiveRight?l.to>=h.ch:l.to>h.ch)))if(n&&s.clearOnEnter)(o||(o=[])).push(s);else if(s.atomic){if(a=s.find()[0>f?"from":"to"],At(a,h)&&(a.ch+=f,0>a.ch?a=a.line>t.first?Dt(t,Nt(a.line-1)):null:a.ch>i.text.length&&(a=a.line<t.first+t.size-1?Nt(a.line+1,0):null),!a)){if(u)return n?(t.cantEdit=!0,Nt(t.first,0)):Pt(t,e,r,!0);u=!0,a=e,f=-f}h=a;continue t}if(o)for(c=0;c<o.length;++c)o[c].clear()}return h}}function Bt(t,e){for(;;){var r=!1,n=z(t,e),i=Vt(t,n.left,n.top,n.left,n.bottom),o=t.doc.scrollTop,l=t.doc.scrollLeft;if(null!=i.scrollTop&&(ot(t,i.scrollTop),1<Math.abs(t.doc.scrollTop-o)&&(r=!0)),null!=i.scrollLeft&&(lt(t,i.scrollLeft),1<Math.abs(t.doc.scrollLeft-l)&&(r=!0)),!r)return n}}function Rt(t,e,r,n,i){e=Vt(t,e,r,n,i),null!=e.scrollTop&&ot(t,e.scrollTop),null!=e.scrollLeft&&lt(t,e.scrollLeft)}function Vt(t,e,r,n,i){var o,l,s,a,c=t.display,u=c.lineSpace.offsetTop,r=r+u,i=i+u,h=c.scroller.clientHeight-un,f=c.scroller.scrollTop,d={},t=t.doc.height+2*u,p=i+u>t-10;return r<f?d.scrollTop=r<u+10?0:Math.max(0,r):i>f+h&&(d.scrollTop=(p?t:i)-h),o=c.scroller.clientWidth-un,l=c.scroller.scrollLeft,e+=c.gutters.offsetWidth,n+=c.gutters.offsetWidth,s=c.gutters.offsetWidth,a=e<s+10,e<l+s||a?(a&&(e=0),d.scrollLeft=Math.max(0,e-10-s)):n>o+l-3&&(d.scrollLeft=n+10-o),d}function Kt(t,e,r,n){var i,o=t.doc;r||(r="add"),"smart"==r&&(t.doc.mode.indent?i=A(t,e):r="prev");var l,s=t.options.tabSize,a=ze(o,e),c=hr(a.text,null,s),u=a.text.match(/^\s*/)[0];if("smart"==r&&(l=t.doc.mode.indent(i,a.text.slice(u.length),a.text),l==hn)){if(!n)return;r="prev"}if("prev"==r?l=e>o.first?hr(ze(o,e-1).text,null,s):0:"add"==r?l=c+t.options.indentUnit:"subtract"==r&&(l=c-t.options.indentUnit),l=Math.max(0,l),r="",n=0,t.options.indentWithTabs)for(o=Math.floor(l/s);o;--o)n+=s,r+="\t";n<l&&(r+=fr(l-n)),r!=u&&Tt(t.doc,r,Nt(e,0),Nt(e,u.length),"+input"),a.stateAfter=null}function Gt(t,e,r){var n=e,i=e,o=t.doc;return"number"==typeof e?i=ze(o,Math.max(o.first,Math.min(e,o.first+o.size-1))):n=Be(e),null!=n&&r(i,n)?(Y(t,n,n+1),i):null}function Xt(t,e,r,n,i){function o(e){var n=(i?Er:zr)(c,a,r,!0);if(null==n){if((e=!e)&&(e=s+r,e=e<t.first||e>=t.first+t.size?u=!1:(s=e,c=ze(t,e))),!e)return u=!1;a=i?(0>r?Or:Wr)(c):0>r?c.text.length:0}else a=n;return!0}var l,s=e.line,a=e.ch,c=ze(t,s),u=!0;if("char"==n)o();else if("column"==n)o(!0);else if("word"==n)for(e=!1;!(0>r)||o();){if(br(c.text.charAt(a)))e=!0;else if(e){0>r&&(r=1,o());break}if(0<r&&!o())break}return l=Pt(t,Nt(s,a),r,!0),u||(l.hitSide=!0),l}function Ut(t,e,r,n){var i,o,l,s=t.doc,a=e.left;for("page"==n?(o=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),i=e.top+r*o):"line"==n&&(i=0<r?e.bottom+3:e.top-3);l=F(t,a,i),!!l.outside;){if(0>r?0>=i:i>=s.height){l.hitSide=!0;break}i+=5*r}return l}function Yt(t,e){var r,n=e.ch,i=e.ch;if(t){for(!1===e.after||i==t.length?--n:++i,r=t.charAt(n),r=br(r)?br:/\s/.test(r)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!br(t)};0<n&&r(t.charAt(n-1));)--n;for(;i<t.length&&r(t.charAt(i));)++i}return{from:Nt(e.line,n),to:Nt(e.line,i)}}function _t(t,e){zt(t.doc,Nt(e,0),Dt(t.doc,Nt(e+1,0)))}function jt(e,r,n,i){t.defaults[e]=r,n&&(Ur[e]=i?function(t,e,r){r!=_r&&n(t,e,r)}:n)}function $t(t,e){var r,n,i;if(!0===e)return e;if(t.copyState)return t.copyState(e);r={};for(n in e)i=e[n],i instanceof Array&&(i=i.concat([])),r[n]=i;return r}function Zt(t,e,r){return!t.startState||t.startState(e,r)}function qt(t){return"string"==typeof t?Qr[t]:t}function Jt(t,e,r){function n(e){var i,o,l;if(e=qt(e),i=e[t],!1===i)return"stop";if(null!=i&&r(i))return!0;if(e.nofallthrough)return"stop";if(o=e.fallthrough,null==o)return!1;if("[object Array]"!=Object.prototype.toString.call(o))return n(o);for(e=0,i=o.length;e<i;++e)if(l=n(o[e]))return l;return!1}for(var i,o=0;o<e.length;++o)if(i=n(e[o]))return i}function Qt(t){return t=Un[t.keyCode],"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function te(t,e){var r=Un[t.keyCode];return null!=r&&!t.altGraphKey&&(t.altKey&&(r="Alt-"+r),(Bn?t.metaKey:t.ctrlKey)&&(r="Ctrl-"+r),(Bn?t.ctrlKey:t.metaKey)&&(r="Cmd-"+r),!e&&t.shiftKey&&(r="Shift-"+r),r)}function ee(t,e){this.pos=this.start=0,this.string=t,this.tabSize=e||8}function re(t,e){this.lines=[],this.type=e,this.doc=t}function ne(t,e,r,n,i){var o;if(n&&n.shared)return oe(t,e,r,n,i);if(t.cm&&!t.cm.curOp)return G(t.cm,ne)(t,e,r,n,i);if(o=new re(t,i),"range"==i&&!Wt(e,r))return o;n&&gr(n,o),o.replacedWith&&(o.collapsed=!0,o.replacedWith=Cr("span",[o.replacedWith],"CodeMirror-widget")),o.collapsed&&(Kn=!0);var l,s,a,c=e.line,u=0,h=t.cm;if(t.iter(c,r.line+1,function(n){h&&o.collapsed&&!h.options.lineWrapping&&fe(t,n)==h.display.maxLine&&(a=!0);var i={from:null,to:null,marker:o};u+=n.text.length,c==e.line&&(i.from=e.ch,u-=e.ch),c==r.line&&(i.to=r.ch,u-=n.text.length-r.ch),o.collapsed&&(c==r.line&&(s=ue(n,r.ch)),c==e.line?l=ue(n,e.ch):Pe(n,0)),n.markedSpans=n.markedSpans?n.markedSpans.concat([i]):[i],i.marker.attachLine(n),++c}),o.collapsed&&t.iter(e.line,r.line+1,function(e){de(t,e)&&Pe(e,0)}),o.readOnly&&(Vn=!0,(t.history.done.length||t.history.undone.length)&&t.clearHistory()),o.collapsed){if(l!=s)throw Error("Inserting collapsed marker overlapping an existing one");o.size=u,o.atomic=!0}return h&&(a&&(h.curOp.updateMaxLine=!0),(o.className||o.startStyle||o.endStyle||o.collapsed)&&Y(h,e.line,r.line+1),o.atomic&&Ft(h)),o}function ie(t,e){this.markers=t,this.primary=e;for(var r=0,n=this;r<t.length;++r)t[r].parent=this,ir(t[r],"clear",function(){n.clear()})}function oe(t,e,r,n,i){n=gr(n),n.shared=!1;var o=[ne(t,e,r,n,i)],l=o[0];return He(t,function(t){o.push(ne(t,Dt(t,e),Dt(t,r),n,i));for(var s=0;s<t.linked.length;++s)if(t.linked[s].isParent)return;l=dr(o)}),new ie(o,l)}function le(t,e){var r,n;if(t)for(r=0;r<t.length;++r)if(n=t[r],n.marker==e)return n}function se(t,e){var r,n,i,o,l=Et(t,e.from.line)&&ze(t,e.from.line).markedSpans,s=Et(t,e.to.line)&&ze(t,e.to.line).markedSpans;if(!l&&!s)return null;var a,c,u,h=e.from.ch,f=e.to.ch,d=At(e.from,e.to);if(l)for(a=0;a<l.length;++a){var p=l[a],m=p.marker;!(null==p.from||(m.inclusiveLeft?p.from<=h:p.from<h))&&("bookmark"!=m.type||p.from!=h||d&&p.marker.insertLeft)||(u=null==p.to||(m.inclusiveRight?p.to>=h:p.to>h),(c||(c=[])).push({from:p.from,to:u?null:p.to,marker:m}))}var g,l=c;if(s)for(a=0;a<s.length;++a)c=s[a],u=c.marker,(null==c.to||(u.inclusiveRight?c.to>=f:c.to>f)||"bookmark"==u.type&&c.from==f&&(!d||c.marker.insertLeft))&&(g=null==c.from||(u.inclusiveLeft?c.from<=f:c.from<f),(r||(r=[])).push({from:g?null:c.from-f,to:null==c.to?null:c.to-f,marker:u}));if(f=r,d=1==e.text.length,g=dr(e.text).length+(d?h:0),l)for(s=0;s<l.length;++s)r=l[s],null==r.to&&(n=le(f,r.marker),n?d&&(r.to=null==n.to?null:n.to+g):r.to=h);if(f)for(s=0;s<f.length;++s)r=f[s],null!=r.to&&(r.to+=g),null==r.from?(n=le(l,r.marker),n||(r.from=g,d&&(l||(l=[])).push(r))):(r.from+=g,d&&(l||(l=[])).push(r));if(n=[l],!d){if(i=e.text.length-2,0<i&&l)for(s=0;s<l.length;++s)null==l[s].to&&(o||(o=[])).push({from:null,to:null,marker:l[s].marker});for(s=0;s<i;++s)n.push(o);n.push(f)}return n}function ae(t,e){var r;r=e["spans_"+t.id];var n,i;if(r){for(n=0,i=[];n<e.text.length;++n)i.push(_e(r[n]));r=i}else r=null;n=se(t,e);var o,l,s,a,c;if(!r)return n;if(!n)return r;for(i=0;i<r.length;++i)if(o=r[i],l=n[i],o&&l){s=0;t:for(;s<l.length;++s){for(a=l[s],c=0;c<o.length;++c)if(o[c].marker==a.marker)continue t;o.push(a)}}else l&&(r[i]=l);return r}function ce(t,e,r){var n,i,o,l,s=null;if(t.iter(e.line,r.line+1,function(t){var e,r;if(t.markedSpans)for(e=0;e<t.markedSpans.length;++e)r=t.markedSpans[e].marker,r.readOnly&&(!s||-1==mr(s,r))&&(s||(s=[])).push(r)}),!s)return null;for(t=[{from:e,to:r}],e=0;e<s.length;++e)for(r=s[e],n=r.find(),i=0;i<t.length;++i)o=t[i],Wt(o.to,n.from)||Wt(n.to,o.from)||(l=[i,1],(Wt(o.from,n.from)||!r.inclusiveLeft&&At(o.from,n.from))&&l.push({from:o.from,to:n.from}),(Wt(n.to,o.to)||!r.inclusiveRight&&At(o.to,n.to))&&l.push({from:n.to,to:o.to}),t.splice.apply(t,l),i+=l.length-1);return t}function ue(t,e){var r,n,i,o=Kn&&t.markedSpans;if(o)for(i=0;i<o.length;++i)n=o[i],n.marker.collapsed&&(null==n.from||n.from<e)&&(null==n.to||n.to>e)&&(!r||r.width<n.marker.width)&&(r=n.marker);return r}function he(t){return ue(t,t.text.length+1)}function fe(t,e){for(var r;r=ue(e,-1);)e=ze(t,r.find().from.line);return e}function de(t,e){var r,n,i=Kn&&e.markedSpans;if(i)for(n=0;n<i.length;++n)if(r=i[n],r.marker.collapsed&&(null==r.from||0==r.from&&r.marker.inclusiveLeft&&pe(t,e,r)))return!0}function pe(t,e,r){var n,i,o;if(null==r.to)return n=r.marker.find().to,i=ze(t,n.line),pe(t,i,le(i.markedSpans,r.marker));if(r.marker.inclusiveRight&&r.to==e.text.length)return!0;for(n=0;n<e.markedSpans.length;++n)if(o=e.markedSpans[n],o.marker.collapsed&&o.from==r.to&&(o.marker.inclusiveLeft||r.marker.inclusiveRight)&&pe(t,e,o))return!0}function me(t){var e,r=t.markedSpans;if(r){for(e=0;e<r.length;++e)r[e].marker.detachLine(t);t.markedSpans=null}}function ge(t,e){if(e){for(var r=0;r<e.length;++r)e[r].marker.attachLine(t);t.markedSpans=e}}function ve(t){return function(){var e,r=!this.cm.curOp;r&&V(this.cm);try{e=t.apply(this,arguments)}finally{r&&K(this.cm)}return e}}function ye(t){return null!=t.height?t.height:(t.node.parentNode&&1==t.node.parentNode.nodeType||Lr(t.cm.display.measure,Cr("div",[t.node],null,"position: relative")),t.height=t.node.offsetHeight)}function be(t,e,r,n){var i=new tn(t,r,n);return i.noHScroll&&(t.display.alignWidgets=!0),Gt(t,e,function(e){if((e.widgets||(e.widgets=[])).push(i),i.line=e,!de(t.doc,e)||i.showIfHidden){var r=Ve(t,e)<t.display.scroller.scrollTop;Pe(e,e.height+ye(i)),r&&(t.curOp.updateScrollPos={scrollTop:t.doc.scrollTop+i.height,scrollLeft:t.doc.scrollLeft})}return!0}),i}function xe(t,e,r){return t={text:t},ge(t,e),t.height=r?r(t):1,t}function Ce(t,e,r,n){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),me(t),ge(t,r),e=n?n(t):1,e!=t.height&&Pe(t,e),sr(t,"change")}function we(t,e,r,n,i){var o,l,s=t.options.flattenSpans,a="",c=null,t=new ee(e,t.options.tabSize);for(""==e&&r.blankLine&&r.blankLine(n);!t.eol();)o=r.token(t,n),5e3<t.pos&&(s=!1,t.pos=Math.min(e.length,t.start+5e4),o=null),l=t.current(),t.start=t.pos,s&&c==o?a+=l:(a&&i(a,c),a=l,c=o);a&&i(a,c)}function Le(t,e,r){var n,i,o=[t.state.modeGen];for(we(t,e.text,t.doc.mode,r,function(t,e){o.push(t,e)}),r=0;r<t.state.overlays.length;++r)n=t.state.overlays[r],i=1,we(t,e.text,n.mode,!0,function(t,e){for(var r,l,s=i,a=t.length;a;)l=o[i],r=l.length,r<=a?a-=r:(o.splice(i,1,l.slice(0,a),o[i+1],l.slice(a)),a=0),i+=2;if(e)if(n.opaque)o.splice(s,i-s,t,e),i=s+2;else for(;s<i;s+=2)l=o[s+1],o[s+1]=l?l+" "+e:e});return o}function ke(t,e,r){var n=t.doc.mode,t=new ee(e.text,t.options.tabSize);for(""==e.text&&n.blankLine&&n.blankLine(r);!t.eol()&&5e3>=t.pos;)n.token(t,r),t.start=t.pos}function Se(t){return t?en[t]||(en[t]="cm-"+t.replace(/ +/g," cm-")):null}function Me(t,e,r){for(var n,i,o,l,s,a,c,u,h,f=e,d=!0;n=ue(f,-1);)d=!1,f=ze(t.doc,n.find().from.line),i||(i=f);n={pre:Cr("pre"),col:0,pos:0,display:!r,measure:null,addedOne:!1,cm:t},f.textClass&&(n.pre.className=f.textClass);do{n.measure=f==e&&r,n.pos=0,n.addToken=n.measure?Ne:Te,r&&o&&f!=e&&!n.addedOne&&(r[0]=n.pre.appendChild(Tr(t.display.measure)),n.addedOne=!0);t:{var p=f;o=n,f.styles&&f.styles[0]==t.state.modeGen||(f.styles=Le(t,f,f.stateAfter=A(t,Be(f)))),l=f.styles;var m=p.markedSpans,g=void 0,v=void 0,y=void 0,b=void 0,x=void 0,C=v=void 0,w=void 0;if(m)for(var p=p.text.length,L=0,g=1,k="",S=void 0,M=0,T=void 0,N=void 0,W=void 0,O=void 0;;){if(M==L){for(T=N=W="",O=null,M=1/0,v=null,y=0;y<m.length;++y)b=m[y],x=b.marker,b.from<=L&&(null==b.to||b.to>L)?(null!=b.to&&M>b.to&&(M=b.to,N=""),x.className&&(T+=" "+x.className),x.startStyle&&b.from==L&&(W+=" "+x.startStyle),x.endStyle&&b.to==M&&(N+=" "+x.endStyle),x.collapsed&&(!O||O.marker.width<x.width)&&(O=b)):b.from>L&&M>b.from&&(M=b.from),"bookmark"==x.type&&b.from==L&&x.replacedWith&&(v=x.replacedWith);if(O&&(O.from||0)==L&&(Ae(o,(null==O.to?p:O.to)-L,null!=O.from&&O.marker.replacedWith),null==O.to)){o=O.marker.find();break t}v&&!O&&Ae(o,0,v)}if(L>=p)break;for(v=Math.min(p,M);;){if(k){if(C=L+k.length,O||(w=C>v?k.slice(0,v-L):k,o.addToken(o,w,S?S+T:T,W,L+w.length==M?N:"")),C>=v){k=k.slice(v-L),L=v;break}L=C,W=""}k=l[g++],S=Se(l[g++])}}else for(g=1;g<l.length;g+=2)o.addToken(o,l[g],Se(l[g+1]));o=void 0}l=o,o=f==i,l&&(f=ze(t.doc,l.to.line),d=!1)}while(l);return r&&!n.addedOne&&(r[0]=n.pre.appendChild(d?Cr("span","\xa0"):Tr(t.display.measure))),n.pre.firstChild||de(t.doc,e)||n.pre.appendChild(document.createTextNode("\xa0")),r&&wn&&(s=Ke(f))&&(a=s.length-1,s[a].from==s[a].to&&--a,c=s[a],u=s[a-1],c.from+1==c.to&&u&&c.level<u.level&&(h=r[n.pos-1],h&&h.parentNode.insertBefore(h.measureRight=Tr(t.display.measure),h.nextSibling))),n.pre}function Te(t,e,r,n,i){var o,l,s,a,c,u,h,f;if(e){if(rn.test(e))for(o=document.createDocumentFragment(),l=0;rn.lastIndex=l,s=rn.exec(e),a=s?s.index-l:e.length-l,a&&(o.appendChild(document.createTextNode(e.slice(l,l+a))),t.col+=a),!!s;)l+=a+1,"\t"==s[0]?(c=t.cm.options.tabSize,u=c-t.col%c,o.appendChild(Cr("span",fr(u),"cm-tab")),t.col+=u):(h=Cr("span","\u2022","cm-invalidchar"),h.title="\\u"+s[0].charCodeAt(0).toString(16),o.appendChild(h),t.col+=1);else t.col+=e.length,o=document.createTextNode(e);if(r||n||i||t.measure)return f=r||"",n&&(f+=n),i&&(f+=i),t.pre.appendChild(Cr("span",[o],f));t.pre.appendChild(o)}}function Ne(t,e,r,n,i){for(var o,l,s=0;s<e.length;++s)o=e.charAt(s),l=0==s,"\ufffd"<=o&&"\ufffd">o&&s<e.length-1?(o=e.slice(s,s+2),++s):s&&t.cm.options.lineWrapping&&gn.test(e.slice(s-1,s+1))&&t.pre.appendChild(Cr("wbr")),t.measure[t.pos]=Te(t,o,r,l&&n,s==e.length-1&&i),t.pos+=o.length;e.length&&(t.addedOne=!0)}function Ae(t,e,r){r&&(t.display||(r=r.cloneNode(!0)),t.pre.appendChild(r),t.measure&&e&&(t.measure[t.pos]=r,t.addedOne=!0)),t.pos+=e}function We(t,e,r,n,i){function o(t){return r?r[t]:null}var l=e.from,s=e.to,a=e.text,c=ze(t,l.line),u=ze(t,s.line),h=dr(a),f=o(a.length-1),d=s.line-l.line;if(0==l.ch&&0==s.ch&&""==h){for(var p=0,m=a.length-1,g=[];p<m;++p)g.push(xe(a[p],o(p),i));Ce(u,u.text,f,i),d&&t.remove(l.line,d),g.length&&t.insert(l.line,g)}else if(c==u)if(1==a.length)Ce(c,c.text.slice(0,l.ch)+h+c.text.slice(s.ch),f,i);else{for(g=[],p=1,m=a.length-1;p<m;++p)g.push(xe(a[p],o(p),i));g.push(xe(h+c.text.slice(s.ch),f,i)),Ce(c,c.text.slice(0,l.ch)+a[0],o(0),i),t.insert(l.line+1,g)}else if(1==a.length)Ce(c,c.text.slice(0,l.ch)+a[0]+u.text.slice(s.ch),o(0),i),t.remove(l.line+1,d);else{for(Ce(c,c.text.slice(0,l.ch)+a[0],o(0),i),Ce(u,h+u.text.slice(s.ch),f,i),p=1,m=a.length-1,g=[];p<m;++p)g.push(xe(a[p],o(p),i));1<d&&t.remove(l.line+1,d-1),t.insert(l.line+1,g)}sr(t,"change",t,e),It(t,n.anchor,n.head,null,!0)}function Oe(t){this.lines=t,this.parent=null;for(var e=0,r=t.length,n=0;e<r;++e)t[e].parent=this,n+=t[e].height;this.height=n}function De(t){var e,r,n,i,o;for(this.children=t,n=r=e=0,i=t.length;n<i;++n)o=t[n],e+=o.chunkSize(),r+=o.height,o.parent=this;this.size=e,this.height=r,this.parent=null}function He(t,e,r){function n(t,i,o){var l,s,a;if(t.linked)for(l=0;l<t.linked.length;++l)s=t.linked[l],s.doc!=i&&(a=o&&s.sharedHist,!r||a)&&(e(s.doc,a),n(s.doc,t,a))}n(t,null,!0)}function Ee(t,e){if(e.cm)throw Error("This document is already in use.");t.doc=e,e.cm=t,i(t),r(t),t.options.lineWrapping||c(t),t.options.mode=e.modeOption,Y(t)}function ze(t,e){for(var r,n,i,e=e-t.first;!t.lines;)for(r=0;;++r){if(n=t.children[r],i=n.chunkSize(),e<i){t=n;break}e-=i}return t.lines[e]}function Ie(t,e,r){var n=[],i=e.line;return t.iter(e.line,r.line+1,function(t){t=t.text,i==r.line&&(t=t.slice(0,r.ch)),i==e.line&&(t=t.slice(e.ch)),n.push(t),++i}),n}function Fe(t,e,r){var n=[];return t.iter(e,r,function(t){n.push(t.text)}),n}function Pe(t,e){for(var r=e-t.height,n=t;n;n=n.parent)n.height+=r}function Be(t){var e,r,n;if(null==t.parent)return null;for(e=t.parent,t=mr(e.lines,t),r=e.parent;r;e=r,r=r.parent)for(n=0;r.children[n]!=e;++n)t+=r.children[n].chunkSize();return t+e.first}function Re(t,e){var r,n,i,o,l,s,a=t.first;t:do{for(i=0,o=t.children.length;i<o;++i){if(r=t.children[i],n=r.height,e<n){t=r;continue t}e-=n,a+=r.chunkSize()}return a}while(!t.lines);for(i=0,o=t.lines.length;i<o&&(l=t.lines[i],s=l.height,!(e<s));++i)e-=s;return a+i}function Ve(t,e){var r,n,i,o,l,e=fe(t.doc,e);for(r=0,n=e.parent,o=0;o<n.lines.length&&(i=n.lines[o],!(i==e));++o)r+=i.height;for(i=n.parent;i;n=i,i=n.parent)for(o=0;o<i.children.length&&(l=i.children[o],!(l==n));++o)r+=l.height;return r}function Ke(t){var e=t.order;return null==e&&(e=t.order=xn(t.text)),e}function Ge(){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,dirtyCounter:0}}function Xe(t,e,r,n){var i=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,r),Math.min(t.first+t.size,n),function(r){r.markedSpans&&((i||(i=e["spans_"+t.id]={}))[o]=r.markedSpans),++o})}function Ue(t,e){var r={from:e.from,to:vt(e),text:Ie(t,e.from,e.to)};return Xe(t,r,e.from.line,e.to.line+1),He(t,function(t){Xe(t,r,e.from.line,e.to.line+1)},!0),r}function Ye(t,e,r,n){var i,o,l,s=t.history;if(s.undone.length=0,i=+new Date,o=dr(s.done),o&&(s.lastOp==n||s.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&s.lastTime>i-600||"*"==e.origin.charAt(0))))l=dr(o.changes),At(e.from,e.to)&&At(e.from,l.to)?l.to=vt(e):o.changes.push(Ue(t,e)),o.anchorAfter=r.anchor,o.headAfter=r.head;else{for(o={changes:[Ue(t,e)],anchorBefore:t.sel.anchor,headBefore:t.sel.head,anchorAfter:r.anchor,headAfter:r.head},s.done.push(o);s.done.length>s.undoDepth;)s.done.shift();0>s.dirtyCounter?s.dirtyCounter=NaN:s.dirtyCounter++}s.lastTime=i,s.lastOp=n,s.lastOrigin=e.origin}function _e(t){if(!t)return null;for(var e,r=0;r<t.length;++r)t[r].marker.explicitlyCleared?e||(e=t.slice(0,r)):e&&e.push(t[r]);return e?e.length?e:null:t}function je(t,e){for(var r,n,i,o,l=0,s=[];l<t.length;++l){r=t[l];var a=r.changes,c=[];for(s.push({changes:c,anchorBefore:r.anchorBefore,headBefore:r.headBefore,anchorAfter:r.anchorAfter,headAfter:r.headAfter}),r=0;r<a.length;++r)if(n=a[r],c.push({from:n.from,to:n.to,text:n.text}),e)for(o in n)(i=o.match(/^spans_(\d+)$/))&&-1<mr(e,Number(i[1]))&&(dr(c)[o]=n[o],delete n[o])}return s}function $e(t,e,r,n){r<t.line?t.line+=n:e<t.line&&(t.line=e,t.ch=0)}function Ze(t,e,r,n){for(var i,o,l,s,a=0;a<t.length;++a){for(i=t[a],o=!0,l=0;l<i.changes.length;++l)if(s=i.changes[l],i.copied||(s.from=Ot(s.from),s.to=Ot(s.to)),r<s.from.line)s.from.line+=n,s.to.line+=n;else if(e<=s.to.line){o=!1;break}i.copied||(i.anchorBefore=Ot(i.anchorBefore),i.headBefore=Ot(i.headBefore),i.anchorAfter=Ot(i.anchorAfter),i.readAfter=Ot(i.headAfter),i.copied=!0),o?($e(i.anchorBefore),$e(i.headBefore),$e(i.anchorAfter),$e(i.headAfter)):(t.splice(0,a+1),a=0)}}function qe(t,e){var r=e.from.line,n=e.to.line,i=e.text.length-(n-r)-1;Ze(t.done,r,n,i),Ze(t.undone,r,n,i)}function Je(){rr(this)}function Qe(t){return t.stop||(t.stop=Je),t}function tr(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function er(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function rr(t){tr(t),er(t)}function nr(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),In&&t.ctrlKey&&1==e&&(e=3),e}function ir(t,e,r){t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent?t.attachEvent("on"+e,r):(t=t._handlers||(t._handlers={}),(t[e]||(t[e]=[])).push(r))}function or(t,e,r){var n;if(t.removeEventListener)t.removeEventListener(e,r,!1);else if(t.detachEvent)t.detachEvent("on"+e,r);else if(n=t._handlers&&t._handlers[e],!!n)for(t=0;t<n.length;++t)if(n[t]==r){n.splice(t,1);break}}function lr(t,e){var r,n,i=t._handlers&&t._handlers[e];if(i)for(r=Array.prototype.slice.call(arguments,2),n=0;n<i.length;++n)i[n].apply(null,r)}function sr(t,e){function r(t){return function(){t.apply(null,n)}}var n,i,o=t._handlers&&t._handlers[e];if(o)for(n=Array.prototype.slice.call(arguments,2),an||(++cn,an=[],setTimeout(ar,0)),i=0;i<o.length;++i)an.push(r(o[i]))}function ar(){var t,e;for(--cn,t=an,an=null,e=0;e<t.length;++e)t[e]()}function cr(t,e){var r=t._handlers&&t._handlers[e];return r&&0<r.length}function ur(){this.id=null}function hr(t,e,r){null==e&&(e=t.search(/[^\s\u00a0]/),-1==e&&(e=t.length));for(var n=0,i=0;n<e;++n)"\t"==t.charAt(n)?i+=r-i%r:++i;return i}function fr(t){for(;fn.length<=t;)fn.push(dr(fn)+" ");return fn[t]}function dr(t){return t[t.length-1]}function pr(t){En?(t.selectionStart=0,t.selectionEnd=t.value.length):t.select()}function mr(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;++r)if(t[r]==e)return r;return-1}function gr(t,e){e||(e={});for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function vr(t){for(var e=[],r=0;r<t;++r)e.push(void 0);return e}function yr(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function br(t){return/\w/.test(t)||"\x80"<t&&(t.toUpperCase()!=t.toLowerCase()||dn.test(t))}function xr(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}function Cr(t,e,r,n){if(t=document.createElement(t),r&&(t.className=r),n&&(t.style.cssText=n),"string"==typeof e)kr(t,e);else if(e)for(r=0;r<e.length;++r)t.appendChild(e[r]);return t}function wr(t){if(wn)for(;t.firstChild;)t.removeChild(t.firstChild);else t.innerHTML="";return t}function Lr(t,e){return wr(t).appendChild(e)}function kr(t,e){kn?(t.innerHTML="",t.appendChild(document.createTextNode(e))):t.textContent=e}function Sr(t){return t.getBoundingClientRect()}function Mr(t){if(null!=vn)return vn;var e=Cr("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return Lr(t,e),e.offsetWidth&&(vn=e.offsetHeight-e.clientHeight),vn||0}function Tr(t){if(null==yn){var e=Cr("span","\u200b");Lr(t,Cr("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(yn=1>=e.offsetWidth&&2<e.offsetHeight&&!Ln)}return yn?Cr("span","\u200b"):Cr("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px")}function Nr(t,e,r,n){var i,o;if(!t)return n(e,r,"ltr");for(i=0;i<t.length;++i)o=t[i],(o.from<r&&o.to>e||e==r&&o.to==e)&&n(Math.max(o.from,e),Math.min(o.to,r),1==o.level?"rtl":"ltr")}function Ar(t){return t.level%2?t.from:t.to}function Wr(t){return(t=Ke(t))?t[0].level%2?t[0].to:t[0].from:0}function Or(t){var e=Ke(t);return e?Ar(dr(e)):t.text.length}function Dr(t,e){var r,n,i=ze(t.doc,e),o=fe(t.doc,i);return o!=i&&(e=Be(o)),r=Ke(o),n=r?r[0].level%2?Or(o):Wr(o):0,Nt(e,n)}function Hr(t,e){for(var r,n,i,o;r=he(n=ze(t.doc,e));)e=r.find().to.line;return i=Ke(n),o=i?i[0].level%2?Wr(n):Or(n):n.text.length,Nt(e,o)}function Er(t,e,r,n){var i,o,l,s,a=Ke(t);if(!a)return zr(t,e,r,n);for(n=n?function(e,r){do e+=r;while(0<e&&pn.test(t.text.charAt(e)));return e}:function(t,e){return t+e},i=a[0].level,o=0;o<a.length&&(l=a[o],s=l.level%2==i,!(l.from<e&&l.to>e||s&&(l.from==e||l.to==e)));++o);for(e=n(e,l.level%2?-r:r);null!=e;)if(l.level%2==i){if(!(e<l.from||e>l.to))break;e=(l=a[o+=r])&&(0<r==l.level%2?n(l.to,-1):n(l.from,1))}else if(e==(l.level%2?l.to:l.from))e=(l=a[--o])&&Ar(l);else{if(e!=Ar(l))break;e=(l=a[++o])&&(l.level%2?l.to:l.from)}return 0>e||e>t.text.length?null:e}function zr(t,e,r,n){if(e+=r,n)for(;0<e&&pn.test(t.text.charAt(e));)e+=r;return 0>e||e>t.text.length?null:e}var Ir,Fr,Pr,Br,Rr,Vr,Kr,Gr,Xr,Ur,Yr,_r,jr,$r,Zr,qr,Jr,Qr,tn,en,rn,nn,on,ln,sn,an,cn,un,hn,fn,dn,pn,mn,gn,vn,yn,bn,xn,Cn=/gecko\/\d/i.test(navigator.userAgent),wn=/MSIE \d/.test(navigator.userAgent),Ln=wn&&(null==document.documentMode||8>document.documentMode),kn=wn&&(null==document.documentMode||9>document.documentMode),Sn=/WebKit\//.test(navigator.userAgent),Mn=Sn&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Tn=/Chrome\//.test(navigator.userAgent),Nn=/Opera\//.test(navigator.userAgent),An=/Apple Computer/.test(navigator.vendor),Wn=/KHTML\//.test(navigator.userAgent),On=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Dn=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Hn=/PhantomJS/.test(navigator.userAgent),En=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),zn=En||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),In=En||/Mac/.test(navigator.platform),Fn=/windows/i.test(navigator.platform),Pn=Nn&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Pn&&(Pn=Number(Pn[1]));var Bn=In&&(Mn||Nn&&(null==Pn||12.11>Pn)),Rn=Cn||wn&&!kn,Vn=!1,Kn=!1;Rr=Fr=0,Vr=null,wn?Vr=-.53:Cn?Vr=15:Tn?Vr=-.7:An&&(Vr=-1/3),Gr=null,t.Pos=Nt,t.prototype={focus:function(){window.focus(),q(this),pt(this),j(this)},setOption:function(t,e){var r=this.options,n=r[t];(r[t]!=e||"mode"==t)&&(r[t]=e,Ur.hasOwnProperty(t)&&G(this,Ur[t])(this,e,n));
},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t){this.state.keyMaps.push(t)},removeKeyMap:function(t){for(var e=this.state.keyMaps,r=0;r<e.length;++r)if(("string"==typeof t?e[r].name:e[r])==t)return e.splice(r,1),!0},addOverlay:G(null,function(e,r){var n=e.token?e:t.getMode(this.options,e);if(n.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:e,opaque:r&&r.opaque}),this.state.modeGen++,Y(this)}),removeOverlay:G(null,function(t){for(var e=this.state.overlays,r=0;r<e.length;++r)if(e[r].modeSpec==t){e.splice(r,1),this.state.modeGen++,Y(this);break}}),indentLine:G(null,function(t,e,r){"string"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),Et(this.doc,t)&&Kt(this,t,e,r)}),indentSelection:G(null,function(t){var e,r=this.doc.sel;if(At(r.from,r.to))return Kt(this,r.from.line,t);for(e=r.to.line-(r.to.ch?0:1),r=r.from.line;r<=e;++r)Kt(this,r,t)}),getTokenAt:function(t){for(var e,r=this.doc,t=Dt(r,t),n=A(this,t.line),i=this.doc.mode,r=ze(r,t.line),r=new ee(r.text,this.options.tabSize);r.pos<t.ch&&!r.eol();)r.start=r.pos,e=i.token(r,n);return{start:r.start,end:r.pos,string:r.current(),className:e||null,type:e||null,state:n}},getStateAfter:function(t){var e=this.doc;return t=Math.max(e.first,Math.min(null==t?e.first+e.size-1:t,e.first+e.size-1)),A(this,t+1)},cursorCoords:function(t,e){var r,n=this.doc.sel;return r=null==t?n.head:"object"==typeof t?Dt(this.doc,t):t?n.from:n.to,z(this,r,e||"page")},charCoords:function(t,e){return E(this,Dt(this.doc,t),e||"page")},coordsChar:function(t){var e=Sr(this.display.lineSpace);return F(this,t.left-e.left-(window.pageXOffset||(document.documentElement||document.body).scrollLeft),t.top-e.top-(window.pageYOffset||(document.documentElement||document.body).scrollTop))},defaultTextHeight:function(){return B(this.display)},setGutterMarker:G(null,function(t,e,r){return Gt(this,t,function(t){var n=t.gutterMarkers||(t.gutterMarkers={});return n[e]=r,!r&&xr(n)&&(t.gutterMarkers=null),!0})}),clearGutter:G(null,function(t){var e=this,r=e.doc,n=r.first;r.iter(function(r){r.gutterMarkers&&r.gutterMarkers[t]&&(r.gutterMarkers[t]=null,Y(e,n,n+1),xr(r.gutterMarkers)&&(r.gutterMarkers=null)),++n})}),addLineClass:G(null,function(t,e,r){return Gt(this,t,function(t){var n="text"==e?"textClass":"background"==e?"bgClass":"wrapClass";if(t[n]){if(RegExp("\\b"+r+"\\b").test(t[n]))return!1;t[n]+=" "+r}else t[n]=r;return!0})}),removeLineClass:G(null,function(t,e,r){return Gt(this,t,function(t){var n,i="text"==e?"textClass":"background"==e?"bgClass":"wrapClass",o=t[i];if(!o)return!1;if(null==r)t[i]=null;else{if(n=o.replace(RegExp("^"+r+"\\b\\s*|\\s*\\b"+r+"\\b"),""),n==o)return!1;t[i]=n||null}return!0})}),addLineWidget:G(null,function(t,e,r){return be(this,t,e,r)}),removeLineWidget:function(t){t.clear()},lineInfo:function(t){var e;if("number"==typeof t){if(!Et(this.doc,t)||(e=t,t=ze(this.doc,t),!t))return null}else if(e=Be(t),null==e)return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(t,e,r,n,i){var o,l,s,a,c=this.display,t=z(this,Dt(this.doc,t));o=t.bottom,l=t.left,e.style.position="absolute",c.sizer.appendChild(e),"over"==n?o=t.top:("above"==n||"near"==n)&&(s=Math.max(c.wrapper.clientHeight,this.doc.height),a=Math.max(c.sizer.clientWidth,c.lineSpace.clientWidth),("above"==n||t.bottom+e.offsetHeight>s)&&t.top>e.offsetHeight?o=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=s&&(o=t.bottom),l+e.offsetWidth>a&&(l=a-e.offsetWidth)),e.style.top=o+c.lineSpace.offsetTop+"px",e.style.left=e.style.right="","right"==i?(l=c.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==i?l=0:"middle"==i&&(l=(c.sizer.clientWidth-e.offsetWidth)/2),e.style.left=l+"px"),r&&Rt(this,l,o,l+e.offsetWidth,o+e.offsetHeight)},triggerOnKeyDown:G(null,ft),execCommand:function(t){return Jr[t](this)},findPosH:function(t,e,r,n){var i,o=1;for(0>e&&(o=-1,e=-e),i=0,t=Dt(this.doc,t);i<e&&(t=Xt(this.doc,t,o,r,n),!t.hitSide);++i);return t},moveH:G(null,function(t,e){var r=this.doc.sel,r=r.shift||r.extend||At(r.from,r.to)?Xt(this.doc,r.head,t,e,this.options.rtlMoveVisually):0>t?r.from:r.to;zt(this.doc,r,r,t)}),deleteH:G(null,function(t,e){var r=this.doc.sel;At(r.from,r.to)?Tt(this.doc,"",r.from,Xt(this.doc,r.head,t,e,!1),"+delete"):Tt(this.doc,"",r.from,r.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(t,e,r,n){var i,o,l=1;for(0>e&&(l=-1,e=-e),i=0,t=Dt(this.doc,t);i<e&&(o=z(this,t,"div"),null==n?n=o.left:o.left=n,t=Ut(this,o,l,r),!t.hitSide);++i);return t},moveV:G(null,function(t,e){var r,n=this.doc.sel,i=z(this,n.head,"div");null!=n.goalColumn&&(i.left=n.goalColumn),r=Ut(this,i,t,e),"page"==e&&(this.display.scrollbarV.scrollTop+=E(this,r,"div").top-i.top),zt(this.doc,r,r,t),n.goalColumn=i.left}),toggleOverwrite:function(){(this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite","")},scrollTo:G(null,function(t,e){this.curOp.updateScrollPos={scrollLeft:t,scrollTop:e}}),getScrollInfo:function(){var t=this.display.scroller,e=un;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-e,width:t.scrollWidth-e,clientHeight:t.clientHeight-e,clientWidth:t.clientWidth-e}},scrollIntoView:function(t){"number"==typeof t&&(t=Nt(t,0)),t&&null==t.line?Rt(this,t.left,t.top,t.right,t.bottom):(t=t?Dt(this.doc,t):this.doc.sel.head,Bt(this,t))},setSize:function(t,e){function r(t){return"number"==typeof t||/^\d+$/.test(""+t)?t+"px":t}null!=t&&(this.display.wrapper.style.width=r(t)),null!=e&&(this.display.wrapper.style.height=r(e)),this.refresh()},on:function(t,e){ir(this,t,e)},off:function(t,e){or(this,t,e)},operation:function(t){return U(this,t)},refresh:G(null,function(){D(this),this.curOp.updateScrollPos={scrollTop:this.doc.scrollTop,scrollLeft:this.doc.scrollLeft},Y(this)}),swapDoc:G(null,function(t){var e=this.doc;return e.cm=null,Ee(this,t),D(this),this.curOp.updateScrollPos={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft},e}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ur=t.optionHandlers={},Yr=t.defaults={},_r=t.Init={toString:function(){return"CodeMirror.Init"}},jt("value","",function(t,e){t.setValue(e)},!0),jt("mode",null,function(t,e){t.doc.modeOption=e,r(t)},!0),jt("indentUnit",2,r,!0),jt("indentWithTabs",!1),jt("smartIndent",!0),jt("tabSize",4,function(t){r(t),D(t),Y(t)},!0),jt("electricChars",!0),jt("rtlMoveVisually",!Fn),jt("theme","default",function(t){o(t),l(t)},!0),jt("keyMap","default",function(t){var e=Qr[t.options.keyMap].style;t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(e?" cm-keymap-"+e:"")}),jt("extraKeys",null),jt("onKeyEvent",null),jt("onDragEvent",null),jt("lineWrapping",!1,function(t){t.options.lineWrapping?(t.display.wrapper.className=t.display.wrapper.className+" CodeMirror-wrap",t.display.sizer.style.minWidth=""):(t.display.wrapper.className=t.display.wrapper.className.replace(" CodeMirror-wrap",""),c(t)),i(t),Y(t),D(t),setTimeout(function(){h(t.display,t.doc.height)},100)},!0),jt("gutters",[],function(t){u(t.options),l(t)},!0),jt("fixedGutter",!0,function(t,e){t.display.gutters.style.left=e?m(t.display)+"px":"0",t.refresh()},!0),jt("lineNumbers",!1,function(t){u(t.options),l(t)},!0),jt("firstLineNumber",1,l,!0),jt("lineNumberFormatter",function(t){return t},l,!0),jt("showCursorWhenSelecting",!1,L,!0),jt("readOnly",!1,function(t,e){"nocursor"==e?(mt(t),t.display.input.blur()):e||Z(t,!0)}),jt("dragDrop",!0),jt("cursorBlinkRate",530),jt("cursorHeight",1),jt("workTime",100),jt("workDelay",100),jt("flattenSpans",!0),jt("pollInterval",100),jt("undoDepth",40,function(t,e){t.doc.history.undoDepth=e}),jt("viewportMargin",10,function(t){t.refresh()},!0),jt("tabindex",null,function(t,e){t.display.input.tabIndex=e||""}),jt("autofocus",null),jr=t.modes={},$r=t.mimeModes={},t.defineMode=function(e,r){if(t.defaults.mode||"null"==e||(t.defaults.mode=e),2<arguments.length){r.dependencies=[];for(var n=2;n<arguments.length;++n)r.dependencies.push(arguments[n])}jr[e]=r},t.defineMIME=function(t,e){$r[t]=e},t.resolveMode=function(e){if("string"==typeof e&&$r.hasOwnProperty(e))e=$r[e];else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return t.resolveMode("application/xml");return"string"==typeof e?{name:e}:e||{name:"null"}},t.getMode=function(e,r){var n,i,o;if(r=t.resolveMode(r),n=jr[r.name],!n)return t.getMode(e,"text/plain");if(n=n(e,r),Zr.hasOwnProperty(r.name))for(o in i=Zr[r.name])i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o]);return n.name=r.name,n},t.defineMode("null",function(){return{token:function(t){t.skipToEnd()}}}),t.defineMIME("text/plain","null"),Zr=t.modeExtensions={},t.extendMode=function(t,e){var r=Zr.hasOwnProperty(t)?Zr[t]:Zr[t]={};gr(e,r)},t.defineExtension=function(e,r){t.prototype[e]=r},t.defineOption=jt,qr=[],t.defineInitHook=function(t){qr.push(t)},t.copyState=$t,t.startState=Zt,t.innerMode=function(t,e){for(;t.innerMode;)var r=t.innerMode(e),e=r.state,t=r.mode;return r||{mode:t,state:e}},Jr=t.commands={selectAll:function(t){t.setSelection(Nt(t.firstLine(),0),Nt(t.lastLine()))},killLine:function(t){var e=t.getCursor(!0),r=t.getCursor(!1),n=!At(e,r);n||t.getLine(e.line).length!=e.ch?t.replaceRange("",e,n?r:Nt(e.line),"+delete"):t.replaceRange("",e,Nt(e.line+1,0),"+delete")},deleteLine:function(t){var e=t.getCursor().line;t.replaceRange("",Nt(e,0),Nt(e),"+delete")},undo:function(t){t.undo()},redo:function(t){t.redo()},goDocStart:function(t){t.extendSelection(Nt(t.firstLine(),0))},goDocEnd:function(t){t.extendSelection(Nt(t.lastLine()))},goLineStart:function(t){t.extendSelection(Dr(t,t.getCursor().line))},goLineStartSmart:function(t){var e,r,n=t.getCursor(),i=Dr(t,n.line),o=t.getLineHandle(i.line),l=Ke(o);l&&0!=l[0].level?t.extendSelection(i):(e=Math.max(0,o.text.search(/\S/)),r=n.line==i.line&&n.ch<=e&&n.ch,t.extendSelection(Nt(i.line,r?0:e)))},goLineEnd:function(t){t.extendSelection(Hr(t,t.getCursor().line))},goLineUp:function(t){t.moveV(-1,"line")},goLineDown:function(t){t.moveV(1,"line")},goPageUp:function(t){t.moveV(-1,"page")},goPageDown:function(t){t.moveV(1,"page")},goCharLeft:function(t){t.moveH(-1,"char")},goCharRight:function(t){t.moveH(1,"char")},goColumnLeft:function(t){t.moveH(-1,"column")},goColumnRight:function(t){t.moveH(1,"column")},goWordLeft:function(t){t.moveH(-1,"word")},goWordRight:function(t){t.moveH(1,"word")},delCharBefore:function(t){t.deleteH(-1,"char")},delCharAfter:function(t){t.deleteH(1,"char")},delWordBefore:function(t){t.deleteH(-1,"word")},delWordAfter:function(t){t.deleteH(1,"word")},indentAuto:function(t){t.indentSelection("smart")},indentMore:function(t){t.indentSelection("add")},indentLess:function(t){t.indentSelection("subtract")},insertTab:function(t){t.replaceSelection("\t","end","+input")},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.replaceSelection("\t","end","+input")},transposeChars:function(t){var e=t.getCursor(),r=t.getLine(e.line);0<e.ch&&e.ch<r.length-1&&t.replaceRange(r.charAt(e.ch)+r.charAt(e.ch-1),Nt(e.line,e.ch-1),Nt(e.line,e.ch+1))},newlineAndIndent:function(t){G(t,function(){t.replaceSelection("\n","end","+input"),t.indentLine(t.getCursor().line,null,!0)})()},toggleOverwrite:function(t){t.toggleOverwrite()}},Qr=t.keyMap={},Qr.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},Qr.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordBefore","Ctrl-Delete":"delWordAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},Qr.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordBefore","Ctrl-Alt-Backspace":"delWordAfter","Alt-Delete":"delWordAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},Qr["default"]=In?Qr.macDefault:Qr.pcDefault,Qr.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},t.lookupKey=Jt,t.isModifierKey=Qt,t.keyName=te,t.fromTextArea=function(e,r){function n(){e.value=a.getValue()}var i,o,l,s,a;if(r||(r={}),r.value=e.value,!r.tabindex&&e.tabindex&&(r.tabindex=e.tabindex),null==r.autofocus){i=document.body;try{i=document.activeElement}catch(t){}r.autofocus=i==e||null!=e.getAttribute("autofocus")&&i==document.body}if(e.form){ir(e.form,"submit",n),o=e.form,l=o.submit;try{s=o.submit=function(){n(),o.submit=l,o.submit(),o.submit=s}}catch(t){}}return e.style.display="none",a=t(function(t){e.parentNode.insertBefore(t,e.nextSibling)},r),a.save=n,a.getTextArea=function(){return e},a.toTextArea=function(){n(),e.parentNode.removeChild(a.getWrapperElement()),e.style.display="",e.form&&(or(e.form,"submit",n),"function"==typeof e.form.submit&&(e.form.submit=l))},a},ee.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(t){var e,r=this.string.charAt(this.pos);return e="string"==typeof t?r==t:r&&(t.test?t.test(r):t(r)),e?(++this.pos,r):void 0},eatWhile:function(t){for(var e=this.pos;this.eat(t););return this.pos>e},eatSpace:function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},skipToEnd:function(){this.pos=this.string.length},skipTo:function(t){if(t=this.string.indexOf(t,this.pos),-1<t)return this.pos=t,!0},backUp:function(t){this.pos-=t},column:function(){return hr(this.string,this.start,this.tabSize)},indentation:function(){return hr(this.string,null,this.tabSize)},match:function(t,e,r){var n,i;return"string"!=typeof t?(i=this.string.slice(this.pos).match(t),i&&0<i.index?null:(i&&!1!==e&&(this.pos+=i[0].length),i)):(n=function(t){return r?t.toLowerCase():t},n(this.string).indexOf(n(t),this.pos)==this.pos?(!1!==e&&(this.pos+=t.length),!0):void 0)},current:function(){return this.string.slice(this.start,this.pos)}},t.StringStream=ee,t.TextMarker=re,re.prototype.clear=function(){var t,e,r,n,i,o,l;if(!this.explicitlyCleared){for((e=(t=this.doc.cm)&&!t.curOp)&&V(t),n=r=null,l=0;l<this.lines.length;++l){i=this.lines[l],o=le(i.markedSpans,this),null!=o.to&&(n=Be(i));for(var s=i,c=i.markedSpans,u=o,h=void 0,f=0;f<c.length;++f)c[f]!=u&&(h||(h=[])).push(c[f]);s.markedSpans=h,null!=o.from?r=Be(i):this.collapsed&&!de(this.doc,i)&&t&&Pe(i,B(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(l=0;l<this.lines.length;++l)i=fe(t.doc,this.lines[l]),o=a(t.doc,i),o>t.display.maxLineLength&&(t.display.maxLine=i,t.display.maxLineLength=o,t.display.maxLineChanged=!0);null!=r&&t&&Y(t,r,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.collapsed&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Ft(t)),e&&K(t),sr(this,"clear")}},re.prototype.find=function(){for(var t,e,r,n,i,o=0;o<this.lines.length;++o)r=this.lines[o],n=le(r.markedSpans,this),(null!=n.from||null!=n.to)&&(i=Be(r),null!=n.from&&(t=Nt(i,n.from)),null!=n.to&&(e=Nt(i,n.to)));return"bookmark"==this.type?t:t&&{from:t,to:e}},re.prototype.getOptions=function(t){var e=this.replacedWith;return{className:this.className,inclusiveLeft:this.inclusiveLeft,inclusiveRight:this.inclusiveRight,atomic:this.atomic,collapsed:this.collapsed,clearOnEnter:this.clearOnEnter,replacedWith:t?e&&e.cloneNode(!0):e,readOnly:this.readOnly,startStyle:this.startStyle,endStyle:this.endStyle}},re.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=mr(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},re.prototype.detachLine=function(t){this.lines.splice(mr(this.lines,t),1),!this.lines.length&&this.doc.cm&&(t=this.doc.cm.curOp,(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this))},t.SharedTextMarker=ie,ie.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();sr(this,"clear")}},ie.prototype.find=function(){return this.primary.find()},ie.prototype.getOptions=function(t){return t=this.primary.getOptions(t),t.shared=!0,t},tn=t.LineWidget=function(t,e,r){for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);this.cm=t,this.node=e},tn.prototype.clear=ve(function(){var t,e=this.line.widgets,r=Be(this.line);if(null!=r&&e){for(t=0;t<e.length;++t)e[t]==this&&e.splice(t--,1);e.length||(this.line.widgets=null),Pe(this.line,Math.max(0,this.line.height-ye(this))),Y(this.cm,r,r+1)}}),tn.prototype.changed=ve(function(){var t,e,r=this.height;this.height=null,(t=ye(this)-r)&&(Pe(this.line,this.line.height+t),e=Be(this.line),Y(this.cm,e,e+1))}),en={},rn=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g,Oe.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var r,n=t,i=t+e;n<i;++n){r=this.lines[n],this.height-=r.height;var o=r;o.parent=null,me(o),sr(r,"delete")}this.lines.splice(t,e)},collapse:function(t){t.splice.apply(t,[t.length,0].concat(this.lines))},insertInner:function(t,e,r){for(this.height+=r,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t)),t=0,r=e.length;t<r;++t)e[t].parent=this},iterN:function(t,e,r){for(e=t+e;t<e;++t)if(r(this.lines[t]))return!0}},De.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){var r,n,i,o,l,s;for(this.size-=e,r=0;r<this.children.length;++r)if(n=this.children[r],i=n.chunkSize(),t<i){if(o=Math.min(e,i-t),l=n.height,n.removeInner(t,o),this.height-=l-n.height,i==o&&(this.children.splice(r--,1),n.parent=null),0==(e-=o))break;t=0}else t-=i;25>this.size-e&&(s=[],this.collapse(s),this.children=[new Oe(s)],this.children[0].parent=this)},collapse:function(t){for(var e=0,r=this.children.length;e<r;++e)this.children[e].collapse(t)},insertInner:function(t,e,r){var n,i,o,l;for(this.size+=e.length,this.height+=r,n=0,i=this.children.length;n<i;++n){if(o=this.children[n],l=o.chunkSize(),t<=l){if(o.insertInner(t,e,r),o.lines&&50<o.lines.length){for(;50<o.lines.length;)t=o.lines.splice(o.lines.length-25,25),t=new Oe(t),o.height-=t.height,this.children.splice(n+1,0,t),t.parent=this;this.maybeSpill()}break}t-=l}},maybeSpill:function(){var t,e,r,n;if(!(10>=this.children.length)){t=this;do e=t.children.splice(t.children.length-5,5),e=new De(e),t.parent?(t.size-=e.size,t.height-=e.height,n=mr(t.parent.children,t),t.parent.children.splice(n+1,0,e)):(r=new De(t.children),r.parent=t,t.children=[r,e],t=r),e.parent=t.parent;while(10<t.children.length);t.parent.maybeSpill()}},iterN:function(t,e,r){for(var n,i,o,l=0,s=this.children.length;l<s;++l)if(n=this.children[l],i=n.chunkSize(),t<i){if(o=Math.min(e,i-t),n.iterN(t,o,r))return!0;if(0==(e-=o))break;t=0}else t-=i}},nn=0,on=t.Doc=function(t,e,r){return this instanceof on?(null==r&&(r=0),De.call(this,[new Oe([xe("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=Ge(),this.frontier=r,r=Nt(r,0),this.sel={from:r,to:r,head:r,anchor:r,shift:!1,extend:!1,goalColumn:null},this.id=++nn,this.modeOption=e,"string"==typeof t&&(t=bn(t)),void We(this,{from:r,to:r,text:t},null,{head:r,anchor:r})):new on(t,e,r)},on.prototype=function(t,e){function r(){}r.prototype=t;var n=new r;return e&&gr(e,n),n}(De.prototype,{iter:function(t,e,r){r?this.iterN(t-this.first,e-t,r):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var r=0,n=0,i=e.length;n<i;++n)r+=e[n].height;this.insertInner(t-this.first,e,r)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=Fe(this,this.first,this.first+this.size);return!1===t?e:e.join(t||"\n")},setValue:function(t){var e=Nt(this.first,0),r=this.first+this.size-1;Ct(this,{from:e,to:Nt(r,ze(this,r).text.length),text:bn(t),origin:"setValue"},{head:e,anchor:e},!0)},replaceRange:function(t,e,r,n){e=Dt(this,e),r=r?Dt(this,r):e,Tt(this,t,e,r,n)},getRange:function(t,e,r){return t=Ie(this,Dt(this,t),Dt(this,e)),!1===r?t:t.join(r||"\n")},getLine:function(t){return(t=this.getLineHandle(t))&&t.text},setLine:function(t,e){Et(this,t)&&Tt(this,e,Nt(t,0),Dt(this,Nt(t)))},removeLine:function(t){Et(this,t)&&Tt(this,"",Nt(t,0),Dt(this,Nt(t+1,0)))},getLineHandle:function(t){if(Et(this,t))return ze(this,t)},getLineNumber:function(t){return Be(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return Dt(this,t)},getCursor:function(t){var e,r=this.sel;return e=null==t||"head"==t?r.head:"anchor"==t?r.anchor:"end"==t||!1===t?r.to:r.from,Ot(e)},somethingSelected:function(){return!At(this.sel.head,this.sel.anchor)},setCursor:X(function(t,e,r){t=Dt(this,"number"==typeof t?Nt(t,e||0):t),r?zt(this,t):It(this,t,t)}),setSelection:X(function(t,e){It(this,Dt(this,t),Dt(this,e||t))}),extendSelection:X(function(t,e){zt(this,Dt(this,t),e&&Dt(this,e))}),getSelection:function(t){return this.getRange(this.sel.from,this.sel.to,t)},replaceSelection:function(t,e,r){Ct(this,{from:this.sel.from,to:this.sel.to,text:bn(t),origin:r},e||"around")},undo:X(function(){Lt(this,"undo")}),redo:X(function(){Lt(this,"redo")}),setExtending:function(t){this.sel.extend=t},historySize:function(){var t=this.history;return{undo:t.done.length,redo:t.undone.length}},clearHistory:function(){this.history=Ge()},markClean:function(){this.history.dirtyCounter=0,this.history.lastOp=this.history.lastOrigin=null},isClean:function(){return 0==this.history.dirtyCounter},getHistory:function(){return{done:je(this.history.done),undone:je(this.history.undone)}},setHistory:function(t){var e=this.history=Ge();e.done=t.done.slice(0),e.undone=t.undone.slice(0)},markText:function(t,e,r){return ne(this,Dt(this,t),Dt(this,e),r,"range")},setBookmark:function(t,e){var r={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft};return t=Dt(this,t),ne(this,t,t,r,"bookmark")},findMarksAt:function(t){var e,r,n,i;if(t=Dt(this,t),e=[],r=ze(this,t.line).markedSpans)for(n=0;n<r.length;++n)i=r[n],(null==i.from||i.from<=t.ch)&&(null==i.to||i.to>=t.ch)&&e.push(i.marker.parent||i.marker);return e},getAllMarks:function(){var t=[];return this.iter(function(e){var r,e=e.markedSpans;if(e)for(r=0;r<e.length;++r)null!=e[r].from&&t.push(e[r].marker)}),t},posFromIndex:function(t){var e,r=this.first;return this.iter(function(n){return n=n.text.length+1,n>t?(e=t,!0):(t-=n,void++r)}),Dt(this,Nt(r,e))},indexFromPos:function(t){var t=Dt(this,t),e=t.ch;return t.line<this.first||0>t.ch?0:(this.iter(this.first,t.line,function(t){e+=t.text.length+1}),e)},copy:function(t){var e=new on(Fe(this,this.first,this.first+this.size),this.modeOption,this.first);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){var e,r,n;return t||(t={}),e=this.first,r=this.first+this.size,null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<r&&(r=t.to),n=new on(Fe(this,e,r),t.mode||this.modeOption,e),t.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:t.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],n},unlinkDoc:function(e){var r,n,i;if(e instanceof t&&(e=e.doc),this.linked)for(r=0;r<this.linked.length;++r)if(n=this.linked[r],n.doc==e){this.linked.splice(r,1),e.unlinkDoc(this);break}e.history==this.history&&(i=[e.id],He(e,function(t){i.push(t.id)},!0),e.history=Ge(),e.history.done=je(this.history.done,i),e.history.undone=je(this.history.undone,i))},iterLinkedDocs:function(t){He(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),on.prototype.eachLine=on.prototype.iter,ln=["iter","insert","remove","copy","getEditor"];for(sn in on.prototype)on.prototype.hasOwnProperty(sn)&&0>mr(ln,sn)&&(t.prototype[sn]=function(t){return function(){return t.apply(this.doc,arguments)}}(on.prototype[sn]));t.e_stop=rr,t.e_preventDefault=tr,t.e_stopPropagation=er,cn=0,t.on=ir,t.off=or,t.signal=lr,un=30,hn=t.Pass={toString:function(){return"CodeMirror.Pass"}},ur.prototype={set:function(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)}},t.countColumn=hr,fn=[""],dn=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/,pn=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/,t.replaceGetRect=function(t){Sr=t},mn=function(){if(kn)return!1;var t=Cr("div");return"draggable"in t||"dragDrop"in t}(),gn=/^$/,Cn?gn=/$'/:An?gn=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:Tn&&(gn=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/),bn=3!="\n\nb".split(/\n/).length?function(t){for(var e,r,n,i=0,o=[],l=t.length;i<=l;)e=t.indexOf("\n",i),-1==e&&(e=t.length),r=t.slice(i,"\r"==t.charAt(e-1)?e-1:e),n=r.indexOf("\r"),-1!=n?(o.push(r.slice(0,n)),i+=n+1):(o.push(r),i=e+1);return o}:function(t){return t.split(/\r\n?|\n/)},t.splitLines=bn;var Gn=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){try{var e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},Xn=function(){var t=Cr("div");return"oncopy"in t||(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)}(),Un={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};return t.keyNames=Un,function(){for(var t=0;10>t;t++)Un[t+48]=""+t;for(t=65;90>=t;t++)Un[t]=String.fromCharCode(t);for(t=1;12>=t;t++)Un[t+111]=Un[t+63235]="F"+t}(),xn=function(){function t(t){return 255>=t?e.charAt(t):1424<=t&&1524>=t?"R":1536<=t&&1791>=t?r.charAt(t-1536):1792<=t&&2220>=t?"r":"L"}var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",r="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,o=/[LRr]/,l=/[Lb1n]/,s=/[1n]/;return function(e){var r,a,c,u,h,f,d,p;if(!n.test(e))return!1;for(r=e.length,a=[],p=0;p<r;++p)a.push(h=t(e.charCodeAt(p)));for(p=0,c="L";p<r;++p)h=a[p],"m"==h?a[p]=c:c=h;for(p=0,c="L";p<r;++p)h=a[p],"1"==h&&"r"==c?a[p]="n":o.test(h)&&(c=h,"r"==h&&(a[p]="R"));for(p=1,c=a[0];p<r-1;++p)h=a[p],"+"==h&&"1"==c&&"1"==a[p+1]?a[p]="1":","==h&&c==a[p+1]&&("1"==c||"n"==c)&&(a[p]=c),c=h;for(p=0;p<r;++p)if(h=a[p],","==h)a[p]="N";else if("%"==h){for(f=p+1;f<r&&"%"==a[f];++f);for(u=p&&"!"==a[p-1]||f<r-1&&"1"==a[f]?"1":"N",c=p;c<f;++c)a[c]=u;p=f-1}for(p=0,c="L";p<r;++p)h=a[p],"L"==c&&"1"==h?a[p]="L":o.test(h)&&(c=h);for(p=0;p<r;++p)if(i.test(a[p])){for(f=p+1;f<r&&i.test(a[f]);++f);for(c="L"==(f<r-1?a[f]:"L"),u="L"==(p?a[p-1]:"L")||c?"L":"R",c=p;c<f;++c)a[c]=u;p=f-1}for(h=[],p=0;p<r;)if(l.test(a[p])){for(c=p,++p;p<r&&l.test(a[p]);++p);h.push({from:c,to:p,level:0})}else{for(u=p,f=h.length,++p;p<r&&"L"!=a[p];++p);for(c=u;c<p;)if(s.test(a[c])){for(u<c&&h.splice(f,0,{from:u,to:c,level:1}),u=c,++c;c<p&&s.test(a[c]);++c);h.splice(f,0,{from:u,to:c,level:2}),u=c}else++c;u<p&&h.splice(f,0,{from:u,to:p,level:1})}return 1==h[0].level&&(d=e.match(/^\s+/))&&(h[0].from=d[0].length,h.unshift({from:0,to:d[0].length,level:0})),1==dr(h).level&&(d=e.match(/\s+$/))&&(dr(h).to-=d[0].length,h.push({from:r-d[0].length,to:r,level:0})),h[0].level!=dr(h).level&&h.push({from:r,to:r,level:h[0].level}),h}}(),t.version="3.1",t}();